{
  "{\"filename\":\"/app/app.js\",\"env\":{},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/app\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.0": {
    "metadata": {
      "usedHelpers": [
        "asyncToGenerator"
      ],
      "marked": [],
      "modules": {
        "imports": [],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/app/app.js",
      "filenameRelative": "/app/app.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "app.js",
      "sourceFileName": "app.js",
      "sourceRoot": "/app",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/app",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "app"
    },
    "ignored": false,
    "code": "\"use strict\";\n\nvar getFirstMessage = function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/regeneratorRuntime.mark(function _callee(psid) {\n    var text, body, object, firstName, lastName;\n    return regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            text = 'Hey! Great to hear from you.\\n\\nI am going to ask you a few questions and then email a letter to you that can be used to help recover some of your tuition fees.';\n            _context.next = 3;\n            return firstMessage(psid);\n\n          case 3:\n            body = _context.sent;\n            object = JSON.parse(body);\n            firstName = object[\"first_name\"];\n            lastName = object[\"last_name\"];\n\n\n            if (firstName == undefined || lastName == undefined) {\n\n              users[psid].state = states.ask_name;\n              text += '\\n\\nFor some reason I can not access your name. What is your full name?';\n            } else {\n\n              users[psid].state = states.confirm_name;\n              text += \"\\n\\nI have your name as \";\n              text += firstName + \" \" + lastName;\n              text += \", is that right?\";\n              users[psid].first_name = firstName;\n              users[psid].last_name = lastName;\n            }\n            return _context.abrupt(\"return\", text);\n\n          case 9:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, this);\n  }));\n\n  return function getFirstMessage(_x2) {\n    return _ref.apply(this, arguments);\n  };\n}();\n\nfunction _asyncToGenerator(fn) { return function () { var gen = fn.apply(this, arguments); return new Promise(function (resolve, reject) { function step(key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { return Promise.resolve(value).then(function (value) { step(\"next\", value); }, function (err) { step(\"throw\", err); }); } } return step(\"next\"); }); }; }\n\n/*\n * Starter Project for Messenger Platform Quick Start Tutorial\n *\n * Remix this as the starting point for following the Messenger Platform\n * quick start tutorial.\n *\n * https://developers.facebook.com/docs/messenger-platform/getting-started/quick-start/\n *\n */\n\nvar states = Object.freeze({\n  greeting: 0,\n  ask_name: 1,\n  confirm_name: 2,\n  confirm_goldsmiths_student: 3,\n  warning_non_goldsmiths_student: 4,\n  confirm_student_id: 5,\n  ask_how_many_days: 6,\n  ask_how_much_cost: 7,\n  create_signiture: 8,\n  ask_data_format: 9,\n  send: 10,\n  ask_first_name: 11,\n  ask_last_name: 12,\n  ask_email: 13\n});\n\nvar repeatText = \"Sorry I didn't understand your reply :( I'll repeat my last message to you!\";\n\nString.prototype.levenstein = function (string) {\n  var a = this,\n      b = string + \"\",\n      m = [],\n      i,\n      j,\n      min = Math.min;\n\n  if (!(a && b)) return (b || a).length;\n\n  for (i = 0; i <= b.length; m[i] = [i++]) {}\n  for (j = 0; j <= a.length; m[0][j] = j++) {}\n\n  for (i = 1; i <= b.length; i++) {\n    for (j = 1; j <= a.length; j++) {\n      m[i][j] = b.charAt(i - 1) == a.charAt(j - 1) ? m[i - 1][j - 1] : m[i][j] = min(m[i - 1][j - 1] + 1, min(m[i][j - 1] + 1, m[i - 1][j] + 1));\n    }\n  }\n\n  return m[b.length][a.length];\n};\n\nvar verbose = false;\nvar sigFolder = 'public';\nvar publicURL = 'https://grateful-duckling.glitch.me';\n\n'use strict';\n\n// Imports dependencies and set up http server\n\nvar request = require('request'),\n    express = require('express'),\n    goldsmiths = require('./goldsmiths'),\n    body_parser = require('body-parser'),\n    app = express().use(body_parser.json()); // creates express http server\nvar fs = require('fs');\nvar sh = require('shelljs');\nvar nodemailer = require('nodemailer');\nvar validator = require(\"email-validator\");\n\nvar transporter = nodemailer.createTransport({\n  service: 'gmail',\n  auth: {\n    user: process.env.GMAIL_ADDRESS,\n    pass: process.env.GMAIL_PASSWORD\n  }\n});\n\nvar users;\ntry {\n  readUsers();\n} catch (e) {\n  users = {};\n}\n\nvar PAGE_ACCESS_TOKEN = process.env.PAGE_ACCESS_TOKEN;\n\n// Sets server port and logs message on success\napp.listen(process.env.PORT || 1337, function () {\n  return console.log('webhook is listening');\n});\n\napp.use(express.static('public'));\n\n// Define the URLs we'll allow.\nvar ALLOWED_BY = new Set(['https://www.messenger.com/', 'https://www.facebook.com/']);\n\napp.get('/iframe', function (req, res) {\n  // Is the URL in the whitelist?\n  // Set X-Frame-Options if so. Otherwise, we won't\n  // set the header and browsers will block it.\n  var domain = String(req.query.domain);\n  if (ALLOWED_BY.has(domain)) {\n    res.setHeader('X-Frame-Options', 'ALLOW-FROM ' + domain);\n  }\n\n  // Send the iframe as usual.\n  res.sendFile('iframe.html');\n});\n\n// Accepts POST requests at /webhook endpoint\napp.post('/webhook', function (req, res) {\n\n  // Parse the request body from the POST\n  var body = req.body;\n\n  // Check the webhook event is from a Page subscription\n  if (body.object === 'page') {\n\n    // Iterate over each entry - there may be multiple if batched\n    body.entry.forEach(function (entry) {\n\n      // Get the webhook event. entry.messaging is an array, but \n      // will only ever contain one event, so we get index 0\n      var webhook_event = entry.messaging[0];\n\n      if (verbose) console.log(webhook_event);\n\n      // Get the sender PSID\n      var sender_psid = webhook_event.sender.id.toString();\n      if (verbose) console.log('Sender PSID: ' + sender_psid);\n      // Check if the event is a message or a postback\n      // Pass the event to the appropraite handler function.\n\n\n      var message = webhook_event.message;\n\n      var invalidStates = [states.confirm_student_id, states.ask_how_many_days, states.ask_how_much_cost, states.ask_first_name, states.ask_last_name, states.ask_email];\n\n      var validState = true;\n      if (users[sender_psid] != undefined) {\n        for (var i = 0; i < invalidStates.length; ++i) {\n          if (users[sender_psid].state == invalidStates[i]) {\n            validState = false;\n            i = invalidStates.length;\n            break;\n          }\n        }\n      }\n\n      if (message) {\n\n        try {\n          if (validState && (message.text.toLowerCase().levenstein('start again') < 2 || message.text.toLowerCase().levenstein('start') < 2 || message.text.toLowerCase().levenstein('hello') < 2 || message.text.toLowerCase().levenstein('hi') < 2 || message.text.toLowerCase().levenstein('hello there') < 2 || message.text.toLowerCase().levenstein('hi there') < 2 || message.text.toLowerCase().levenstein('begin') < 2)) {\n\n            // Set the response based on the postback payload\n            users[sender_psid] = {};\n            getFirstMessage(sender_psid).then(function (t) {\n\n              var response = getYesNoQuickQuestion(t);\n\n              callSendAPI(sender_psid, response);\n            });\n          } else {\n\n            handleMessage(sender_psid, message);\n          }\n        } catch (error) {\n\n          console.log(error);\n        }\n      } else if (webhook_event.postback) {\n        handlePostback(sender_psid, webhook_event.postback);\n      }\n    });\n\n    // Return a '200 OK' response to all events\n    res.status(200).send('EVENT_RECEIVED');\n  } else {\n    // Return a '404 Not Found' if event is not from a page subscription\n    res.sendStatus(404);\n  }\n});\n\n// Accepts GET requests at the /webhook endpoint\napp.get('/webhook', function (req, res) {\n\n  /** UPDATE YOUR VERIFY TOKEN **/\n  var VERIFY_TOKEN = \"superdude\";\n\n  // Parse params from the webhook verification request\n  var mode = req.query['hub.mode'];\n  var token = req.query['hub.verify_token'];\n  var challenge = req.query['hub.challenge'];\n\n  // Check if a token and mode were sent\n  if (mode && token) {\n\n    // Check the mode and token sent are correct\n    if (mode === 'subscribe' && token === VERIFY_TOKEN) {\n\n      // Respond with 200 OK and challenge token from the request\n      console.log('WEBHOOK_VERIFIED');\n      res.status(200).send(challenge);\n    } else {\n      // Responds with '403 Forbidden' if verify tokens do not match\n      res.sendStatus(403);\n    }\n  }\n});\n\n// Handle POST from xxx/receive\napp.post('/receive', function (request, respond) {\n\n  var body = '';\n\n  request.on('data', function (data) {\n    body += data;\n  });\n\n  request.on('end', function () {\n\n    body = JSON.parse(body);\n\n    var psid = body.name;\n\n    if (psid.length > 25) {\n\n      var stop = void 0;\n      for (var i = 0; i < psid.length; ++i) {\n\n        stop = i;\n        if (isNaN(parseInt(psid[i], 10))) {\n          break;\n        }\n      }\n\n      psid = psid.substring(0, stop);\n    }\n\n    var filePath = __dirname + '/' + sigFolder + '/' + (psid + \".png\");\n\n    notifyUserRecivedSignature(psid);\n\n    // Get rid of the image header as we only need the data parts after it.\n    var data = body.data.replace(/^data:image\\/\\w+;base64,/, \"\");\n    // Create a buffer and set its encoding to base64\n    var buf = new Buffer(data, 'base64');\n    // Write\n    fs.writeFile(filePath, buf, function (err) {\n      if (err) throw err;\n      // Respond to client that the canvas image is saved.\n\n      users[psid].signature_exists = true;\n      respond.end();\n    });\n  });\n});\n\nfunction notifyUserRecivedSignature(psid) {\n\n  users[psid].state = states.ask_data_format;\n  var response = {\n\n    text: 'Great, we got your signature! For now I will only support rendering your letter as a PDF - but more features are coming soon! Please select PDF below to continue :)',\n\n    quick_replies: [{\n      content_type: \"text\",\n      title: \"PDF\",\n      payload: \"LATEX_PAYLOAD\"\n    }]\n\n  };\n\n  callSendAPI(psid, response);\n}\n\nfunction handleTextMessage(sender_psid, received_message) {\n\n  var userState = users[sender_psid].state;\n  var text = void 0;\n  var quickReplies = null;\n\n  if (userState == states.ask_name) {\n\n    text = \"Thanks \" + received_message;\n  } else if (userState == states.ask_first_name) {\n\n    text = \"Thanks \" + received_message + \". Now what is your second name?\";\n    users[sender_psid].first_name = received_message;\n    users[sender_psid].state = states.ask_last_name;\n  } else if (userState == states.ask_last_name) {\n\n    text = \"Awesome! Now are you a goldsmiths student?\";\n    users[sender_psid].last_name = received_message;\n\n    quickReplies = [{\n      content_type: \"text\",\n      title: \"Yes\",\n      payload: \"YES_PAYLOAD\"\n    }, {\n      content_type: \"text\",\n      title: \"No\",\n      payload: \"NO_PAYLOAD\"\n    }];\n    users[sender_psid].state = states.confirm_goldsmiths_student;\n  } else if (userState == states.confirm_student_id) {\n\n    users[sender_psid].student_id = received_message;\n\n    users[sender_psid].state = states.ask_email;\n\n    text = \"Thanks. Next I need to know your email address, prefereably your student one so there is an easy contact method in the correspodance I generate for you. To be clear, I will not store, share or ever send you anything via this email address.\\n\\nPlease write your email adress down next.\";\n  } else if (userState == states.ask_how_much_cost) {\n\n    users[sender_psid].tuition_fee = Number(received_message);\n\n    if (!isNaN(users[sender_psid].tuition_fee)) {\n\n      var days = users[sender_psid].amount_days;\n\n      var cost = moneyOwed(users[sender_psid].tuition_fee, days);\n      users[sender_psid].amount_reimburse = cost;\n\n      text = \"Thanks again! Nearly done now :)\\n\\n\" + (\"I calculate that 14 out of your \" + days + \" days at your tuition cost means you should be reinbursed \\xA3\" + cost + \".\\n\\n\") + \"Would you like to add your signature to the correspondance? \" + \"(A pop-up will appear)\";\n      quickReplies = [{\n        content_type: \"text\",\n        title: \"Sounds cool!\",\n        payload: \"YES_PAYLOAD\"\n      }, {\n        content_type: \"text\",\n        title: \"No Thanks\",\n        payload: \"NO_PAYLOAD\"\n      }];\n\n      users[sender_psid].state = states.create_signiture;\n    }\n  } else if (userState == states.ask_how_many_days) {\n\n    users[sender_psid].amount_days = Number(received_message);\n\n    if (!isNaN(users[sender_psid].amount_days)) {\n\n      users[sender_psid].state = states.ask_how_much_cost;\n\n      text = \"Great thanks for that.\\n\\n\" + \"Next, how much is the tution fees for this academic year?\\n\\n\" + \"Select either a custom amount (in GBP £) or the default, £9000.\";\n      quickReplies = [{\n        content_type: \"text\",\n        title: \"Default £9000\",\n        payload: \"DEFAULT_PAYLOAD\"\n      }, {\n        content_type: \"text\",\n        title: \"Custom\",\n        payload: \"CUSTOM_PAYLOAD\"\n      }];\n    }\n  } else if (userState == states.ask_email) {\n\n    users[sender_psid].email_address = received_message;\n\n    if (validator.validate(users[sender_psid].email_address)) {\n\n      users[sender_psid].state = states.ask_how_many_days;\n\n      text = \"We will now need to work out how much you are owed.\\n\\n\" + \"For now, we will work out the \" + \"fraction of tution fee that you have spent not accessing the \" + \"universities facilities during the 14 day strike. Firstly, we \" + \"need to know how many days there are in your academic year. On \" + \"average (and this is a conservative estimate) there are 170.\\n\\n\" + \"Would you like to use the default 170 days or would you like to \" + \"enter a custom amount?\";\n\n      quickReplies = [{\n        content_type: \"text\",\n        title: \"Default\",\n        payload: \"DEFAULT_PAYLOAD\"\n      }, {\n        content_type: \"text\",\n        title: \"Custom\",\n        payload: \"CUSTOM_PAYLOAD\"\n      }];\n    }\n  }\n\n  var response = { text: text };\n\n  if (quickReplies != null) {\n    response.quick_replies = quickReplies;\n  }\n\n  return response;\n}\n\nfunction handleQuickReply(sender_psid, received_reply) {\n\n  var payload = received_reply.payload;\n  var response = void 0;\n\n  if (payload === 'YES_PAYLOAD') {\n\n    if (users[sender_psid].state == states.confirm_name) {\n\n      response = getYesNoQuickQuestion(\"Great, thanks! Now, are you a Goldsmiths student?\");\n\n      users[sender_psid].state = states.confirm_goldsmiths_student;\n    } else if (users[sender_psid].state == states.confirm_goldsmiths_student) {\n\n      response = {\n        \"text\": \"Okay great, thanks! Can you next tell me what your student ID number is?\"\n      };\n\n      users[sender_psid].university = \"goldsmiths\";\n      users[sender_psid].state = states.confirm_student_id;\n    } else if (users[sender_psid].state == states.create_signiture) {\n\n      response = {\n        attachment: {\n          type: \"template\",\n          payload: {\n            template_type: \"button\",\n            text: \"Draw your signiture!\",\n            buttons: [{\n              type: \"web_url\",\n              url: \"https://grateful-duckling.glitch.me?\" + sender_psid,\n              title: \"Start here\",\n              webview_height_ratio: \"tall\",\n              messenger_extensions: \"true\"\n            }]\n          }\n        }\n      };\n    }\n  } else if (payload === 'NO_PAYLOAD') {\n\n    if (users[sender_psid].state == states.confirm_name) {\n\n      response = {\n        text: \"Okay no problem! Please tell me your first name.\"\n      };\n\n      users[sender_psid].state = states.ask_first_name;\n    } else if (users[sender_psid].state == states.confirm_goldsmiths_student) {\n\n      response = {\n        text: \"Okay no problem! Just be aware that this chatbot and the functionality is in an alpha stage with Goldsmiths students in mind, so there may be a few elements that are not currently available to you. If you have feature requests please leave messages on my facebook page! :)\\n\\nOkay next question - what is your student ID number?\"\n      };\n\n      users[sender_psid].university = \"other\";\n      users[sender_psid].state = states.confirm_student_id;\n    } else if (users[sender_psid].state == states.create_signiture) {\n\n      users[sender_psid].signature_exists = false;\n      users[sender_psid].state = states.ask_data_format;\n      response = {\n\n        text: 'No problem! For now I will only support rendering your letter as a PDF - but more features are coming soon! Please select PDF below to continue :)',\n\n        quick_replies: [{\n          content_type: \"text\",\n          title: \"PDF\",\n          payload: \"LATEX_PAYLOAD\"\n        }]\n\n      };\n    }\n  } else if (payload === 'CUSTOM_PAYLOAD') {\n\n    if (users[sender_psid].state == states.ask_how_many_days) {\n      response = {\n        text: \"Please write in numbers how many days you have in your academic year.\"\n      };\n    } else if (users[sender_psid].state == states.ask_how_much_cost) {\n      response = {\n        text: \"Please write in numbers how much in british pound sterling £ your annual tuition fee is.\"\n      };\n    }\n  } else if (payload === 'DEFAULT_PAYLOAD') {\n\n    if (users[sender_psid].state == states.ask_how_many_days) {\n\n      users[sender_psid].amount_days = 170;\n\n      var text = \"Great thanks for that.\\n\\n\" + \"Next, how much is the tution fees for this academic year?\\n\\n\" + \"Select either a custom amount (in GBP £) or the default, £9000.\";\n      var replies = [{\n        content_type: \"text\",\n        title: \"Default £9000\",\n        payload: \"DEFAULT_PAYLOAD\"\n      }, {\n        content_type: \"text\",\n        title: \"Custom\",\n        payload: \"CUSTOM_PAYLOAD\"\n      }];\n      response = getQuickQuestion(text, replies);\n      users[sender_psid].state = states.ask_how_much_cost;\n    } else if (users[sender_psid].state == states.ask_how_much_cost) {\n\n      var tuitionFee = 9000;\n      users[sender_psid].tuition_fee = tuitionFee;\n      var days = users[sender_psid].amount_days;\n\n      var cost = moneyOwed(tuitionFee, days);\n      users[sender_psid].amount_reimburse = cost;\n      // I calculate that 14 out of your ${days} days at your tuition cost means you should be \n      var _text = \"Thanks again! Nearly done now :)\\n\\n\" + (\"I calculate that 14 out of your \" + days + \" days at your tuition cost means you should be reinbursed \\xA3\" + cost + \".\\n\\n\") + \"Signatures can help improve the authenticity of documents. Would you like to add your signature to the generated correspondance? \";\n      var _replies = [{\n        content_type: \"text\",\n        title: \"Yes\",\n        payload: \"YES_PAYLOAD\"\n      }, {\n        content_type: \"text\",\n        title: \"No\",\n        payload: \"NO_PAYLOAD\"\n      }];\n      response = getQuickQuestion(_text, _replies);\n      users[sender_psid].state = states.create_signiture;\n    }\n  } else if (payload === 'LATEX_PAYLOAD') {\n\n    var isGoldsmiths = users[sender_psid].university == \"goldsmiths\";\n\n    // Create the latex file from template and user data.\n    var latexString = goldsmiths.generateLatexFile(sender_psid, users[sender_psid].first_name, users[sender_psid].last_name, users[sender_psid].email_address, users[sender_psid].student_id, users[sender_psid].tuition_fee, users[sender_psid].amount_days, users[sender_psid].amount_reimburse, users[sender_psid].signature_exists, isGoldsmiths);\n\n    fs.writeFile(\"./public/\" + sender_psid + \".tex\", latexString, function (err) {\n      if (err) {\n        return console.log(err);\n      }\n\n      var shell = void 0;\n      if (users[sender_psid].signature_exists) {\n        shell = \"./laton public/\" + sender_psid + \".tex public/\" + sender_psid + \".png && mv \" + sender_psid + \".pdf public/\";\n      } else {\n        shell = \"./laton public/\" + sender_psid + \".tex && mv \" + sender_psid + \".pdf public/\";\n      }\n\n      // Use laton and wait for pdf to exist.\n\n      var _sh$exec = sh.exec(shell, { silent: true }),\n          stdout = _sh$exec.stdout,\n          stderr = _sh$exec.stderr,\n          code = _sh$exec.code;\n\n      var mailOptions = {\n        from: process.env.GMAIL_ADDRESS, // sender address\n        to: users[sender_psid].email_address, // list of receivers\n        subject: 'Your tuition fee reclaimation letter', // Subject line\n        html: '<p>Hi! Please find attached your tuition fee letter. Make sure you send it to the right people!</p>', // plain text body\n        attachments: [{\n          filename: \"letter.pdf\",\n          path: \"public/\" + sender_psid + \".pdf\"\n        }]\n      };\n      // Send as attachment.\n      // Send the HTTP request to the Messenger Platform\n      transporter.sendMail(mailOptions, function (err, info) {\n        if (verbose) console.log(info);\n\n        // Clean up\n        fs.unlink(\"./public/\" + sender_psid + \".pdf\", function (err) {\n          if (verbose) console.log(\"./public/\" + sender_psid + \".pdf was deleted\");\n        });\n        fs.unlink(\"./public/\" + sender_psid + \".tex\", function (err) {\n          if (verbose) console.log(\"./public/\" + sender_psid + \".tex was deleted\");\n        });\n        if (users[sender_psid].signature_exists) {\n          fs.unlink(\"./public/\" + sender_psid + \".png\", function (err) {\n            if (verbose) console.log(\"./public/\" + sender_psid + \".png was deleted\");\n          });\n        }\n      });\n    });\n\n    response = {\n      \"text\": \"Awesome! I'm just generating your document and a link will be sent to the email adress you supplied earlier! If you would like to use my service again, please select 'start again' from the menu below :)\"\n    };\n  }\n  return response;\n}\n\nfunction moneyOwed(tuition_cost, amount_days) {\n\n  var fractionDays = 14 / amount_days;\n  var fractionCost = fractionDays * tuition_cost;\n  return Math.floor(fractionCost);\n}\n\n// Handles messages events\nfunction handleMessage(sender_psid, received_message) {\n\n  var response = void 0;\n\n  // Check if the message is a quick reply.\n  if (received_message.quick_reply) {\n\n    response = handleQuickReply(sender_psid, received_message.quick_reply);\n  } else if (received_message.text) {\n\n    response = handleTextMessage(sender_psid, received_message.text);\n  }\n\n  var isSig = true;\n\n  try {\n    if (response.attachment.payload.text != 'Draw your signiture!') {\n      isSig = false;\n    }\n  } catch (e) {\n    isSig = false;\n  }\n\n  if (response.text == undefined && !isSig) repeatLastmessage(sender_psid);else\n    // Sends the response message\n    callSendAPI(sender_psid, response);\n}\n\n// Handles messaging_postbacks events\nfunction handlePostback(sender_psid, received_postback) {\n\n  var response = void 0;\n\n  // Get the payload for the postback\n  var payload = received_postback.payload;\n\n  // Set the response based on the postback payload\n  if (payload === 'Greeting' || payload == 'START_AGAIN_PAYLOAD') {\n\n    users[sender_psid] = {};\n    getFirstMessage(sender_psid).then(function (t) {\n\n      response = getYesNoQuickQuestion(t);\n\n      callSendAPI(sender_psid, response);\n    });\n  } else if (payload === 'CONTACT_PAYLOAD') {\n\n    var message = users[sender_psid].last_message;\n\n    // Construct the message body\n    var request_body = {\n      recipient: {\n        id: sender_psid\n      },\n      message: { text: contact() }\n\n      // Send the HTTP request to the Messenger Platform\n    };request({\n      uri: \"https://graph.facebook.com/v2.6/me/messages\",\n      qs: { access_token: PAGE_ACCESS_TOKEN },\n      method: \"POST\",\n      json: request_body\n    }, function (err, res, body) {\n      if (!err) {\n        if (verbose) console.log('message sent!');\n\n        callSendAPI(sender_psid, message.response, message.file_data);\n      } else {\n        console.error(\"Unable to send message:\" + err);\n      }\n    });\n  }\n}\n\nfunction writeUsers() {\n  var string = JSON.stringify(users, null, 2);\n  fs.writeFile('db.json', string, 'utf8', function (err) {\n    if (err) console.log(err);\n  });\n}\n\nfunction readUsers() {\n  fs.readFile('db.json', 'utf8', function (err, fileContent) {\n    if (err) {\n      console.log(err);\n    } else {\n      users = JSON.parse(fileContent.toString());\n      if (verbose) console.log(users);\n    }\n  });\n}\n\n// Sends response messages via the Send API\nfunction callSendAPI(sender_psid, response) {\n  var file_data = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n\n  // Construct the message body\n  var request_body = {\n    recipient: {\n      id: sender_psid\n    },\n    message: response\n  };\n\n  if (file_data != null) {\n    request_body.filedata = file_data;\n  }\n\n  // Send the HTTP request to the Messenger Platform\n  request({\n    uri: \"https://graph.facebook.com/v2.6/me/messages\",\n    qs: { access_token: PAGE_ACCESS_TOKEN },\n    method: \"POST\",\n    json: request_body\n  }, function (err, res, body) {\n    if (!err) {\n      if (verbose) console.log('message sent!');\n    } else {\n      console.error(\"Unable to send message:\" + err);\n    }\n  });\n\n  // save last message\n  if (response.text != repeatText) {\n    users[sender_psid].last_message = {\n      sender_psid: sender_psid,\n      response: response,\n      file_data: file_data\n    };\n  }\n\n  writeUsers();\n}\n\nfunction repeatLastmessage(sender_psid) {\n\n  if (sender_psid == undefined || users[sender_psid] != undefined) {\n\n    var message = users[sender_psid].last_message;\n\n    // Construct the message body\n    var request_body = {\n      recipient: {\n        id: sender_psid\n      },\n      message: { text: repeatText }\n\n      // Send the HTTP request to the Messenger Platform\n    };request({\n      uri: \"https://graph.facebook.com/v2.6/me/messages\",\n      qs: { access_token: PAGE_ACCESS_TOKEN },\n      method: \"POST\",\n      json: request_body\n    }, function (err, res, body) {\n      if (!err) {\n        if (verbose) console.log('message sent!');\n\n        callSendAPI(sender_psid, message.response, message.file_data);\n      } else {\n        console.error(\"Unable to send message:\" + err);\n      }\n    });\n  } else {\n    users[sender_psid] = {};\n    getFirstMessage(sender_psid).then(function (t) {\n      var response = getYesNoQuickQuestion(t);\n      callSendAPI(sender_psid, response);\n    });\n  }\n}\n\nfunction getYesNoQuickQuestion(question) {\n\n  var replies = [{\n    content_type: \"text\",\n    title: \"Yes\",\n    payload: \"YES_PAYLOAD\"\n  }, {\n    content_type: \"text\",\n    title: \"No\",\n    payload: \"NO_PAYLOAD\"\n  }];\n  return getQuickQuestion(question, replies);\n}\n\nfunction getQuickQuestion(question, replies) {\n  return { text: question, quick_replies: replies };\n}\n\nfunction contact() {\n  var body = 'Thanks for wanting to get in touch! You can email me at leonfedden@gmail.com\\n\\nI will now repeat my last message :)';\n  return body;\n}\n\nfunction firstMessage(psid) {\n\n  var uri = \"https://graph.facebook.com/v2.6/\" + psid;\n  return new Promise(function (resolve) {\n\n    request({\n      uri: uri,\n      qs: {\n        access_token: PAGE_ACCESS_TOKEN,\n        fields: \"first_name,last_name\"\n      },\n      method: \"GET\"\n    }, function (error, res, body) {\n      if (!error) {\n\n        resolve(body);\n      } else {\n        console.error(\"Unable to send message:\" + error);\n        resolve(undefined);\n      }\n    });\n  });\n}\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyJdLCJuYW1lcyI6WyJwc2lkIiwidGV4dCIsImZpcnN0TWVzc2FnZSIsImJvZHkiLCJvYmplY3QiLCJKU09OIiwicGFyc2UiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsInVuZGVmaW5lZCIsInVzZXJzIiwic3RhdGUiLCJzdGF0ZXMiLCJhc2tfbmFtZSIsImNvbmZpcm1fbmFtZSIsImZpcnN0X25hbWUiLCJsYXN0X25hbWUiLCJnZXRGaXJzdE1lc3NhZ2UiLCJPYmplY3QiLCJmcmVlemUiLCJncmVldGluZyIsImNvbmZpcm1fZ29sZHNtaXRoc19zdHVkZW50Iiwid2FybmluZ19ub25fZ29sZHNtaXRoc19zdHVkZW50IiwiY29uZmlybV9zdHVkZW50X2lkIiwiYXNrX2hvd19tYW55X2RheXMiLCJhc2tfaG93X211Y2hfY29zdCIsImNyZWF0ZV9zaWduaXR1cmUiLCJhc2tfZGF0YV9mb3JtYXQiLCJzZW5kIiwiYXNrX2ZpcnN0X25hbWUiLCJhc2tfbGFzdF9uYW1lIiwiYXNrX2VtYWlsIiwicmVwZWF0VGV4dCIsIlN0cmluZyIsInByb3RvdHlwZSIsImxldmVuc3RlaW4iLCJzdHJpbmciLCJhIiwiYiIsIm0iLCJpIiwiaiIsIm1pbiIsIk1hdGgiLCJsZW5ndGgiLCJjaGFyQXQiLCJ2ZXJib3NlIiwic2lnRm9sZGVyIiwicHVibGljVVJMIiwicmVxdWVzdCIsInJlcXVpcmUiLCJleHByZXNzIiwiZ29sZHNtaXRocyIsImJvZHlfcGFyc2VyIiwiYXBwIiwidXNlIiwianNvbiIsImZzIiwic2giLCJub2RlbWFpbGVyIiwidmFsaWRhdG9yIiwidHJhbnNwb3J0ZXIiLCJjcmVhdGVUcmFuc3BvcnQiLCJzZXJ2aWNlIiwiYXV0aCIsInVzZXIiLCJwcm9jZXNzIiwiZW52IiwiR01BSUxfQUREUkVTUyIsInBhc3MiLCJHTUFJTF9QQVNTV09SRCIsInJlYWRVc2VycyIsImUiLCJQQUdFX0FDQ0VTU19UT0tFTiIsImxpc3RlbiIsIlBPUlQiLCJjb25zb2xlIiwibG9nIiwic3RhdGljIiwiQUxMT1dFRF9CWSIsIlNldCIsImdldCIsInJlcSIsInJlcyIsImRvbWFpbiIsInF1ZXJ5IiwiaGFzIiwic2V0SGVhZGVyIiwic2VuZEZpbGUiLCJwb3N0IiwiZW50cnkiLCJmb3JFYWNoIiwid2ViaG9va19ldmVudCIsIm1lc3NhZ2luZyIsInNlbmRlcl9wc2lkIiwic2VuZGVyIiwiaWQiLCJ0b1N0cmluZyIsIm1lc3NhZ2UiLCJpbnZhbGlkU3RhdGVzIiwidmFsaWRTdGF0ZSIsInRvTG93ZXJDYXNlIiwidGhlbiIsInJlc3BvbnNlIiwiZ2V0WWVzTm9RdWlja1F1ZXN0aW9uIiwidCIsImNhbGxTZW5kQVBJIiwiaGFuZGxlTWVzc2FnZSIsImVycm9yIiwicG9zdGJhY2siLCJoYW5kbGVQb3N0YmFjayIsInN0YXR1cyIsInNlbmRTdGF0dXMiLCJWRVJJRllfVE9LRU4iLCJtb2RlIiwidG9rZW4iLCJjaGFsbGVuZ2UiLCJyZXNwb25kIiwib24iLCJkYXRhIiwibmFtZSIsInN0b3AiLCJpc05hTiIsInBhcnNlSW50Iiwic3Vic3RyaW5nIiwiZmlsZVBhdGgiLCJfX2Rpcm5hbWUiLCJub3RpZnlVc2VyUmVjaXZlZFNpZ25hdHVyZSIsInJlcGxhY2UiLCJidWYiLCJCdWZmZXIiLCJ3cml0ZUZpbGUiLCJlcnIiLCJzaWduYXR1cmVfZXhpc3RzIiwiZW5kIiwicXVpY2tfcmVwbGllcyIsImNvbnRlbnRfdHlwZSIsInRpdGxlIiwicGF5bG9hZCIsImhhbmRsZVRleHRNZXNzYWdlIiwicmVjZWl2ZWRfbWVzc2FnZSIsInVzZXJTdGF0ZSIsInF1aWNrUmVwbGllcyIsInN0dWRlbnRfaWQiLCJ0dWl0aW9uX2ZlZSIsIk51bWJlciIsImRheXMiLCJhbW91bnRfZGF5cyIsImNvc3QiLCJtb25leU93ZWQiLCJhbW91bnRfcmVpbWJ1cnNlIiwiZW1haWxfYWRkcmVzcyIsInZhbGlkYXRlIiwiaGFuZGxlUXVpY2tSZXBseSIsInJlY2VpdmVkX3JlcGx5IiwidW5pdmVyc2l0eSIsImF0dGFjaG1lbnQiLCJ0eXBlIiwidGVtcGxhdGVfdHlwZSIsImJ1dHRvbnMiLCJ1cmwiLCJ3ZWJ2aWV3X2hlaWdodF9yYXRpbyIsIm1lc3Nlbmdlcl9leHRlbnNpb25zIiwicmVwbGllcyIsImdldFF1aWNrUXVlc3Rpb24iLCJ0dWl0aW9uRmVlIiwiaXNHb2xkc21pdGhzIiwibGF0ZXhTdHJpbmciLCJnZW5lcmF0ZUxhdGV4RmlsZSIsInNoZWxsIiwiZXhlYyIsInNpbGVudCIsInN0ZG91dCIsInN0ZGVyciIsImNvZGUiLCJtYWlsT3B0aW9ucyIsImZyb20iLCJ0byIsInN1YmplY3QiLCJodG1sIiwiYXR0YWNobWVudHMiLCJmaWxlbmFtZSIsInBhdGgiLCJzZW5kTWFpbCIsImluZm8iLCJ1bmxpbmsiLCJ0dWl0aW9uX2Nvc3QiLCJmcmFjdGlvbkRheXMiLCJmcmFjdGlvbkNvc3QiLCJmbG9vciIsInF1aWNrX3JlcGx5IiwiaXNTaWciLCJyZXBlYXRMYXN0bWVzc2FnZSIsInJlY2VpdmVkX3Bvc3RiYWNrIiwibGFzdF9tZXNzYWdlIiwicmVxdWVzdF9ib2R5IiwicmVjaXBpZW50IiwiY29udGFjdCIsInVyaSIsInFzIiwiYWNjZXNzX3Rva2VuIiwibWV0aG9kIiwiZmlsZV9kYXRhIiwid3JpdGVVc2VycyIsInN0cmluZ2lmeSIsInJlYWRGaWxlIiwiZmlsZUNvbnRlbnQiLCJmaWxlZGF0YSIsInF1ZXN0aW9uIiwiUHJvbWlzZSIsInJlc29sdmUiLCJmaWVsZHMiXSwibWFwcGluZ3MiOiI7OztxRUE4M0JBLGlCQUErQkEsSUFBL0I7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQ01DLGdCQUROLEdBQ2Esa0tBRGI7QUFBQTtBQUFBLG1CQUVtQkMsYUFBYUYsSUFBYixDQUZuQjs7QUFBQTtBQUVNRyxnQkFGTjtBQUdNQyxrQkFITixHQUdlQyxLQUFLQyxLQUFMLENBQVdILElBQVgsQ0FIZjtBQUlNSSxxQkFKTixHQUlrQkgsT0FBTyxZQUFQLENBSmxCO0FBS01JLG9CQUxOLEdBS2lCSixPQUFPLFdBQVAsQ0FMakI7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QUFFVnNHLGdCQUFRL00sSUFBUjtBQUVELE9BSkQsTUFJTztBQUNMeUUsZ0JBQVFnQyxLQUFSLENBQWMsNEJBQTRCQSxLQUExQztBQUNBc0csZ0JBQVF6TSxTQUFSO0FBQ0Q7QUFDRixLQWhCRDtBQWlCRCxHQW5CTSxDQUFQO0FBb0JEIiwiZmlsZSI6ImFwcC5qcyIsInNvdXJjZVJvb3QiOiIvYXBwIiwic291cmNlc0NvbnRlbnQiOlsiLypcbiAqIFN0YXJ0ZXIgUHJvamVjdCBmb3IgTWVzc2VuZ2VyIFBsYXRmb3JtIFF1aWNrIFN0YXJ0IFR1dG9yaWFsXG4gKlxuICogUmVtaXggdGhpcyBhcyB0aGUgc3RhcnRpbmcgcG9pbnQgZm9yIGZvbGxvd2luZyB0aGUgTWVzc2VuZ2VyIFBsYXRmb3JtXG4gKiBxdWljayBzdGFydCB0dXRvcmlhbC5cbiAqXG4gKiBodHRwczovL2RldmVsb3BlcnMuZmFjZWJvb2suY29tL2RvY3MvbWVzc2VuZ2VyLXBsYXRmb3JtL2dldHRpbmctc3RhcnRlZC9xdWljay1zdGFydC9cbiAqXG4gKi9cblxuXG5cbnZhciBzdGF0ZXMgPSBPYmplY3QuZnJlZXplKHtcbiAgZ3JlZXRpbmc6IDAsXG4gIGFza19uYW1lOiAxLFxuICBjb25maXJtX25hbWU6IDIsXG4gIGNvbmZpcm1fZ29sZHNtaXRoc19zdHVkZW50OiAzLFxuICB3YXJuaW5nX25vbl9nb2xkc21pdGhzX3N0dWRlbnQ6IDQsXG4gIGNvbmZpcm1fc3R1ZGVudF9pZDogNSxcbiAgYXNrX2hvd19tYW55X2RheXM6IDYsXG4gIGFza19ob3dfbXVjaF9jb3N0OiA3LFxuICBjcmVhdGVfc2lnbml0dXJlOiA4LFxuICBhc2tfZGF0YV9mb3JtYXQ6IDksXG4gIHNlbmQ6IDEwLFxuICBhc2tfZmlyc3RfbmFtZTogMTEsXG4gIGFza19sYXN0X25hbWU6IDEyLFxuICBhc2tfZW1haWw6IDEzXG59KTtcblxuY29uc3QgcmVwZWF0VGV4dCA9IFwiU29ycnkgSSBkaWRuJ3QgdW5kZXJzdGFuZCB5b3VyIHJlcGx5IDooIEknbGwgcmVwZWF0IG15IGxhc3QgbWVzc2FnZSB0byB5b3UhXCI7XG5cblN0cmluZy5wcm90b3R5cGUubGV2ZW5zdGVpbiA9IGZ1bmN0aW9uKHN0cmluZykge1xuICAgIHZhciBhID0gdGhpcywgYiA9IHN0cmluZyArIFwiXCIsIG0gPSBbXSwgaSwgaiwgbWluID0gTWF0aC5taW47XG5cbiAgICBpZiAoIShhICYmIGIpKSByZXR1cm4gKGIgfHwgYSkubGVuZ3RoO1xuXG4gICAgZm9yIChpID0gMDsgaSA8PSBiLmxlbmd0aDsgbVtpXSA9IFtpKytdKTtcbiAgICBmb3IgKGogPSAwOyBqIDw9IGEubGVuZ3RoOyBtWzBdW2pdID0gaisrKTtcblxuICAgIGZvciAoaSA9IDE7IGkgPD0gYi5sZW5ndGg7IGkrKykge1xuICAgICAgICBmb3IgKGogPSAxOyBqIDw9IGEubGVuZ3RoOyBqKyspIHtcbiAgICAgICAgICAgIG1baV1bal0gPSBiLmNoYXJBdChpIC0gMSkgPT0gYS5jaGFyQXQoaiAtIDEpXG4gICAgICAgICAgICAgICAgPyBtW2kgLSAxXVtqIC0gMV1cbiAgICAgICAgICAgICAgICA6IG1baV1bal0gPSBtaW4oXG4gICAgICAgICAgICAgICAgICAgIG1baSAtIDFdW2ogLSAxXSArIDEsIFxuICAgICAgICAgICAgICAgICAgICBtaW4obVtpXVtqIC0gMV0gKyAxLCBtW2kgLSAxIF1bal0gKyAxKSlcbiAgICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBtW2IubGVuZ3RoXVthLmxlbmd0aF07XG59XG5cbmNvbnN0IHZlcmJvc2UgPSBmYWxzZTtcbmNvbnN0IHNpZ0ZvbGRlciA9ICdwdWJsaWMnO1xuY29uc3QgcHVibGljVVJMID0gJ2h0dHBzOi8vZ3JhdGVmdWwtZHVja2xpbmcuZ2xpdGNoLm1lJztcblxuJ3VzZSBzdHJpY3QnO1xuXG4vLyBJbXBvcnRzIGRlcGVuZGVuY2llcyBhbmQgc2V0IHVwIGh0dHAgc2VydmVyXG5cbmNvbnN0IFxuICByZXF1ZXN0ID0gcmVxdWlyZSgncmVxdWVzdCcpLFxuICBleHByZXNzID0gcmVxdWlyZSgnZXhwcmVzcycpLFxuICBnb2xkc21pdGhzID0gcmVxdWlyZSgnLi9nb2xkc21pdGhzJyksXG4gIGJvZHlfcGFyc2VyID0gcmVxdWlyZSgnYm9keS1wYXJzZXInKSxcbiAgYXBwID0gZXhwcmVzcygpLnVzZShib2R5X3BhcnNlci5qc29uKCkpOyAvLyBjcmVhdGVzIGV4cHJlc3MgaHR0cCBzZXJ2ZXJcbmNvbnN0IGZzID0gcmVxdWlyZSgnZnMnKTtcbnZhciBzaCA9IHJlcXVpcmUoJ3NoZWxsanMnKTtcbnZhciBub2RlbWFpbGVyID0gcmVxdWlyZSgnbm9kZW1haWxlcicpO1xudmFyIHZhbGlkYXRvciA9IHJlcXVpcmUoXCJlbWFpbC12YWxpZGF0b3JcIik7XG5cbnZhciB0cmFuc3BvcnRlciA9IG5vZGVtYWlsZXIuY3JlYXRlVHJhbnNwb3J0KHtcbiBzZXJ2aWNlOiAnZ21haWwnLFxuIGF1dGg6IHtcbiAgICAgICAgdXNlcjogcHJvY2Vzcy5lbnYuR01BSUxfQUREUkVTUyxcbiAgICAgICAgcGFzczogcHJvY2Vzcy5lbnYuR01BSUxfUEFTU1dPUkRcbiAgICB9XG59KTtcblxudmFyIHVzZXJzO1xudHJ5IHtcbiAgcmVhZFVzZXJzKCk7XG59IGNhdGNoIChlKSB7XG4gIHVzZXJzID0ge307XG59XG5cbmNvbnN0IFBBR0VfQUNDRVNTX1RPS0VOID0gcHJvY2Vzcy5lbnYuUEFHRV9BQ0NFU1NfVE9LRU47XG5cbi8vIFNldHMgc2VydmVyIHBvcnQgYW5kIGxvZ3MgbWVzc2FnZSBvbiBzdWNjZXNzXG5hcHAubGlzdGVuKHByb2Nlc3MuZW52LlBPUlQgfHwgMTMzNywgKCkgPT4gY29uc29sZS5sb2coJ3dlYmhvb2sgaXMgbGlzdGVuaW5nJykpO1xuXG5hcHAudXNlKGV4cHJlc3Muc3RhdGljKCdwdWJsaWMnKSk7XG5cbi8vIERlZmluZSB0aGUgVVJMcyB3ZSdsbCBhbGxvdy5cbnZhciBBTExPV0VEX0JZID0gbmV3IFNldChbXG4gICdodHRwczovL3d3dy5tZXNzZW5nZXIuY29tLycsXG4gICdodHRwczovL3d3dy5mYWNlYm9vay5jb20vJ1xuXSlcblxuYXBwLmdldCgnL2lmcmFtZScsIGZ1bmN0aW9uIChyZXEsIHJlcykge1xuICAvLyBJcyB0aGUgVVJMIGluIHRoZSB3aGl0ZWxpc3Q/XG4gIC8vIFNldCBYLUZyYW1lLU9wdGlvbnMgaWYgc28uIE90aGVyd2lzZSwgd2Ugd29uJ3RcbiAgLy8gc2V0IHRoZSBoZWFkZXIgYW5kIGJyb3dzZXJzIHdpbGwgYmxvY2sgaXQuXG4gIHZhciBkb21haW4gPSBTdHJpbmcocmVxLnF1ZXJ5LmRvbWFpbilcbiAgaWYgKEFMTE9XRURfQlkuaGFzKGRvbWFpbikpIHtcbiAgICByZXMuc2V0SGVhZGVyKCdYLUZyYW1lLU9wdGlvbnMnLCAnQUxMT1ctRlJPTSAnICsgZG9tYWluKVxuICB9XG5cbiAgLy8gU2VuZCB0aGUgaWZyYW1lIGFzIHVzdWFsLlxuICByZXMuc2VuZEZpbGUoJ2lmcmFtZS5odG1sJylcbn0pXG5cbi8vIEFjY2VwdHMgUE9TVCByZXF1ZXN0cyBhdCAvd2ViaG9vayBlbmRwb2ludFxuYXBwLnBvc3QoJy93ZWJob29rJywgKHJlcSwgcmVzKSA9PiB7ICBcblxuICAvLyBQYXJzZSB0aGUgcmVxdWVzdCBib2R5IGZyb20gdGhlIFBPU1RcbiAgbGV0IGJvZHkgPSByZXEuYm9keTtcblxuICAvLyBDaGVjayB0aGUgd2ViaG9vayBldmVudCBpcyBmcm9tIGEgUGFnZSBzdWJzY3JpcHRpb25cbiAgaWYgKGJvZHkub2JqZWN0ID09PSAncGFnZScpIHtcblxuICAgIC8vIEl0ZXJhdGUgb3ZlciBlYWNoIGVudHJ5IC0gdGhlcmUgbWF5IGJlIG11bHRpcGxlIGlmIGJhdGNoZWRcbiAgICBib2R5LmVudHJ5LmZvckVhY2goZnVuY3Rpb24oZW50cnkpIHtcblxuICAgICAgLy8gR2V0IHRoZSB3ZWJob29rIGV2ZW50LiBlbnRyeS5tZXNzYWdpbmcgaXMgYW4gYXJyYXksIGJ1dCBcbiAgICAgIC8vIHdpbGwgb25seSBldmVyIGNvbnRhaW4gb25lIGV2ZW50LCBzbyB3ZSBnZXQgaW5kZXggMFxuICAgICAgbGV0IHdlYmhvb2tfZXZlbnQgPSBlbnRyeS5tZXNzYWdpbmdbMF07XG4gICAgICBcbiAgICAgIGlmICh2ZXJib3NlKSBjb25zb2xlLmxvZyh3ZWJob29rX2V2ZW50KTtcbiAgICAgIFxuICAgICAgLy8gR2V0IHRoZSBzZW5kZXIgUFNJRFxuICAgICAgbGV0IHNlbmRlcl9wc2lkID0gd2ViaG9va19ldmVudC5zZW5kZXIuaWQudG9TdHJpbmcoKTtcbiAgICAgIGlmICh2ZXJib3NlKSBjb25zb2xlLmxvZygnU2VuZGVyIFBTSUQ6ICcgKyBzZW5kZXJfcHNpZCk7XG4gICAgICAvLyBDaGVjayBpZiB0aGUgZXZlbnQgaXMgYSBtZXNzYWdlIG9yIGEgcG9zdGJhY2tcbiAgICAgIC8vIFBhc3MgdGhlIGV2ZW50IHRvIHRoZSBhcHByb3ByYWl0ZSBoYW5kbGVyIGZ1bmN0aW9uLlxuICAgICAgXG4gICAgICBcbiAgICAgIGNvbnN0IG1lc3NhZ2UgPSB3ZWJob29rX2V2ZW50Lm1lc3NhZ2U7XG4gICAgICBcbiAgICAgIGNvbnN0IGludmFsaWRTdGF0ZXMgPSBbXG4gICAgICAgIHN0YXRlcy5jb25maXJtX3N0dWRlbnRfaWQsXG4gICAgICAgIHN0YXRlcy5hc2tfaG93X21hbnlfZGF5cyxcbiAgICAgICAgc3RhdGVzLmFza19ob3dfbXVjaF9jb3N0LFxuICAgICAgICBzdGF0ZXMuYXNrX2ZpcnN0X25hbWUsXG4gICAgICAgIHN0YXRlcy5hc2tfbGFzdF9uYW1lLFxuICAgICAgICBzdGF0ZXMuYXNrX2VtYWlsXG4gICAgICBdO1xuICAgICAgXG4gICAgICBsZXQgdmFsaWRTdGF0ZSA9IHRydWU7XG4gICAgICBpZiAodXNlcnNbc2VuZGVyX3BzaWRdICE9IHVuZGVmaW5lZCkge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGludmFsaWRTdGF0ZXMubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICBpZiAodXNlcnNbc2VuZGVyX3BzaWRdLnN0YXRlID09IGludmFsaWRTdGF0ZXNbaV0pIHtcbiAgICAgICAgICAgIHZhbGlkU3RhdGUgPSBmYWxzZTtcbiAgICAgICAgICAgIGkgPSBpbnZhbGlkU3RhdGVzLmxlbmd0aDtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgfSBcbiAgICAgIH1cbiAgICAgIFxuICAgICAgaWYgKG1lc3NhZ2UpIHtcbiAgICAgICAgXG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgaWYgKHZhbGlkU3RhdGUgJiYgKFxuICAgICAgICAgICAgICBtZXNzYWdlLnRleHQudG9Mb3dlckNhc2UoKS5sZXZlbnN0ZWluKCdzdGFydCBhZ2FpbicpIDwgMiB8fFxuICAgICAgICAgICAgICBtZXNzYWdlLnRleHQudG9Mb3dlckNhc2UoKS5sZXZlbnN0ZWluKCdzdGFydCcpIDwgMiB8fFxuICAgICAgICAgICAgICBtZXNzYWdlLnRleHQudG9Mb3dlckNhc2UoKS5sZXZlbnN0ZWluKCdoZWxsbycpIDwgMiB8fFxuICAgICAgICAgICAgICBtZXNzYWdlLnRleHQudG9Mb3dlckNhc2UoKS5sZXZlbnN0ZWluKCdoaScpIDwgMiB8fFxuICAgICAgICAgICAgICBtZXNzYWdlLnRleHQudG9Mb3dlckNhc2UoKS5sZXZlbnN0ZWluKCdoZWxsbyB0aGVyZScpIDwgMiB8fFxuICAgICAgICAgICAgICBtZXNzYWdlLnRleHQudG9Mb3dlckNhc2UoKS5sZXZlbnN0ZWluKCdoaSB0aGVyZScpIDwgMiB8fFxuICAgICAgICAgICAgICBtZXNzYWdlLnRleHQudG9Mb3dlckNhc2UoKS5sZXZlbnN0ZWluKCdiZWdpbicpIDwgMikpIHtcblxuICAgICAgICAgICAgLy8gU2V0IHRoZSByZXNwb25zZSBiYXNlZCBvbiB0aGUgcG9zdGJhY2sgcGF5bG9hZFxuICAgICAgICAgICAgdXNlcnNbc2VuZGVyX3BzaWRdID0ge307XG4gICAgICAgICAgICBnZXRGaXJzdE1lc3NhZ2Uoc2VuZGVyX3BzaWQpLnRoZW4odCA9PiB7XG5cbiAgICAgICAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBnZXRZZXNOb1F1aWNrUXVlc3Rpb24odCk7XG5cbiAgICAgICAgICAgICAgY2FsbFNlbmRBUEkoc2VuZGVyX3BzaWQsIHJlc3BvbnNlKTtcbiAgICAgICAgICAgIH0pO1xuXG4gICAgICAgICAgfSBlbHNlIHtcblxuICAgICAgICAgICAgaGFuZGxlTWVzc2FnZShzZW5kZXJfcHNpZCwgbWVzc2FnZSk7XG4gICAgICAgICAgfVxuICAgICAgICBcbiAgICAgICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICBcbiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XG4gICAgICAgIH1cbiAgICAgICAgXG4gICAgICB9IGVsc2UgaWYgKHdlYmhvb2tfZXZlbnQucG9zdGJhY2spIHtcbiAgICAgICAgaGFuZGxlUG9zdGJhY2soc2VuZGVyX3BzaWQsIHdlYmhvb2tfZXZlbnQucG9zdGJhY2spO1xuICAgICAgfVxuICAgIH0pO1xuXG4gICAgLy8gUmV0dXJuIGEgJzIwMCBPSycgcmVzcG9uc2UgdG8gYWxsIGV2ZW50c1xuICAgIHJlcy5zdGF0dXMoMjAwKS5zZW5kKCdFVkVOVF9SRUNFSVZFRCcpO1xuXG4gIH0gZWxzZSB7XG4gICAgLy8gUmV0dXJuIGEgJzQwNCBOb3QgRm91bmQnIGlmIGV2ZW50IGlzIG5vdCBmcm9tIGEgcGFnZSBzdWJzY3JpcHRpb25cbiAgICByZXMuc2VuZFN0YXR1cyg0MDQpO1xuICB9XG5cbn0pO1xuXG4vLyBBY2NlcHRzIEdFVCByZXF1ZXN0cyBhdCB0aGUgL3dlYmhvb2sgZW5kcG9pbnRcbmFwcC5nZXQoJy93ZWJob29rJywgKHJlcSwgcmVzKSA9PiB7XG4gIFxuICAvKiogVVBEQVRFIFlPVVIgVkVSSUZZIFRPS0VOICoqL1xuICBjb25zdCBWRVJJRllfVE9LRU4gPSBcInN1cGVyZHVkZVwiO1xuICBcbiAgLy8gUGFyc2UgcGFyYW1zIGZyb20gdGhlIHdlYmhvb2sgdmVyaWZpY2F0aW9uIHJlcXVlc3RcbiAgbGV0IG1vZGUgPSByZXEucXVlcnlbJ2h1Yi5tb2RlJ107XG4gIGxldCB0b2tlbiA9IHJlcS5xdWVyeVsnaHViLnZlcmlmeV90b2tlbiddO1xuICBsZXQgY2hhbGxlbmdlID0gcmVxLnF1ZXJ5WydodWIuY2hhbGxlbmdlJ107XG4gICAgXG4gIC8vIENoZWNrIGlmIGEgdG9rZW4gYW5kIG1vZGUgd2VyZSBzZW50XG4gIGlmIChtb2RlICYmIHRva2VuKSB7XG4gIFxuICAgIC8vIENoZWNrIHRoZSBtb2RlIGFuZCB0b2tlbiBzZW50IGFyZSBjb3JyZWN0XG4gICAgaWYgKG1vZGUgPT09ICdzdWJzY3JpYmUnICYmIHRva2VuID09PSBWRVJJRllfVE9LRU4pIHtcbiAgICAgIFxuICAgICAgLy8gUmVzcG9uZCB3aXRoIDIwMCBPSyBhbmQgY2hhbGxlbmdlIHRva2VuIGZyb20gdGhlIHJlcXVlc3RcbiAgICAgIGNvbnNvbGUubG9nKCdXRUJIT09LX1ZFUklGSUVEJyk7XG4gICAgICByZXMuc3RhdHVzKDIwMCkuc2VuZChjaGFsbGVuZ2UpO1xuICAgIFxuICAgIH0gZWxzZSB7XG4gICAgICAvLyBSZXNwb25kcyB3aXRoICc0MDMgRm9yYmlkZGVuJyBpZiB2ZXJpZnkgdG9rZW5zIGRvIG5vdCBtYXRjaFxuICAgICAgcmVzLnNlbmRTdGF0dXMoNDAzKTsgICAgICBcbiAgICB9XG4gIH1cbn0pO1xuXG5cbi8vIEhhbmRsZSBQT1NUIGZyb20geHh4L3JlY2VpdmVcbmFwcC5wb3N0KCcvcmVjZWl2ZScsIGZ1bmN0aW9uKHJlcXVlc3QsIHJlc3BvbmQpIHtcbiAgXG4gIGxldCBib2R5ID0gJyc7XG4gIFxuICByZXF1ZXN0Lm9uKCdkYXRhJywgZnVuY3Rpb24oZGF0YSkge1xuICAgIGJvZHkgKz0gZGF0YTtcbiAgfSk7XG4gIFxuICByZXF1ZXN0Lm9uKCdlbmQnLCBmdW5jdGlvbiAoKXtcbiAgICBcbiAgICBib2R5ID0gSlNPTi5wYXJzZShib2R5KTtcbiAgICBcbiAgICBsZXQgcHNpZCA9IGJvZHkubmFtZTtcbiAgICBcbiAgICBpZiAocHNpZC5sZW5ndGggPiAyNSkge1xuXG4gICAgICBsZXQgc3RvcDtcbiAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgcHNpZC5sZW5ndGg7ICsraSkge1xuXG4gICAgICAgIHN0b3AgPSBpO1xuICAgICAgICBpZiAoaXNOYU4ocGFyc2VJbnQocHNpZFtpXSwgMTApKSkge1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHBzaWQgPSBwc2lkLnN1YnN0cmluZygwLCBzdG9wKTtcbiAgICB9XG4gICAgXG4gICAgY29uc3QgZmlsZVBhdGggPSBfX2Rpcm5hbWUgKyAnLycgKyBzaWdGb2xkZXIgKyAnLycgKyBgJHtwc2lkfS5wbmdgO1xuICAgIFxuICAgIG5vdGlmeVVzZXJSZWNpdmVkU2lnbmF0dXJlKHBzaWQpO1xuICAgIFxuICAgIC8vIEdldCByaWQgb2YgdGhlIGltYWdlIGhlYWRlciBhcyB3ZSBvbmx5IG5lZWQgdGhlIGRhdGEgcGFydHMgYWZ0ZXIgaXQuXG4gICAgY29uc3QgZGF0YSA9IGJvZHkuZGF0YS5yZXBsYWNlKC9eZGF0YTppbWFnZVxcL1xcdys7YmFzZTY0LC8sIFwiXCIpO1xuICAgIC8vIENyZWF0ZSBhIGJ1ZmZlciBhbmQgc2V0IGl0cyBlbmNvZGluZyB0byBiYXNlNjRcbiAgICB2YXIgYnVmID0gbmV3IEJ1ZmZlcihkYXRhLCAnYmFzZTY0Jyk7XG4gICAgLy8gV3JpdGVcbiAgICBmcy53cml0ZUZpbGUoZmlsZVBhdGgsIGJ1ZiwgZnVuY3Rpb24oZXJyKXtcbiAgICAgIGlmIChlcnIpIHRocm93IGVyclxuICAgICAgLy8gUmVzcG9uZCB0byBjbGllbnQgdGhhdCB0aGUgY2FudmFzIGltYWdlIGlzIHNhdmVkLlxuICAgICAgXG4gICAgICB1c2Vyc1twc2lkXS5zaWduYXR1cmVfZXhpc3RzID0gdHJ1ZTtcbiAgICAgIHJlc3BvbmQuZW5kKCk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG5cbmZ1bmN0aW9uIG5vdGlmeVVzZXJSZWNpdmVkU2lnbmF0dXJlKHBzaWQpIHtcblxuICB1c2Vyc1twc2lkXS5zdGF0ZSA9IHN0YXRlcy5hc2tfZGF0YV9mb3JtYXQ7XG4gIGNvbnN0IHJlc3BvbnNlID0ge1xuICAgIFxuICAgIHRleHQ6ICdHcmVhdCwgd2UgZ290IHlvdXIgc2lnbmF0dXJlISBGb3Igbm93IEkgd2lsbCBvbmx5IHN1cHBvcnQgcmVuZGVyaW5nIHlvdXIgbGV0dGVyIGFzIGEgUERGIC0gYnV0IG1vcmUgZmVhdHVyZXMgYXJlIGNvbWluZyBzb29uISBQbGVhc2Ugc2VsZWN0IFBERiBiZWxvdyB0byBjb250aW51ZSA6KScsXG4gICAgICBcbiAgICBxdWlja19yZXBsaWVzOiBbXG4gICAgICB7XG4gICAgICAgIGNvbnRlbnRfdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgIHRpdGxlOiBcIlBERlwiLFxuICAgICAgICBwYXlsb2FkOiBcIkxBVEVYX1BBWUxPQURcIlxuICAgICAgfVxuICAgIF0sXG4gICAgXG4gIH07XG4gIFxuICBjYWxsU2VuZEFQSShwc2lkLCByZXNwb25zZSk7XG59XG5cblxuXG5cblxuXG5cblxuXG5cbmZ1bmN0aW9uIGhhbmRsZVRleHRNZXNzYWdlKHNlbmRlcl9wc2lkLCByZWNlaXZlZF9tZXNzYWdlKSB7XG4gIFxuICBsZXQgdXNlclN0YXRlID0gdXNlcnNbc2VuZGVyX3BzaWRdLnN0YXRlO1xuICBsZXQgdGV4dDtcbiAgbGV0IHF1aWNrUmVwbGllcyA9IG51bGw7XG4gIFxuICBpZiAodXNlclN0YXRlID09IHN0YXRlcy5hc2tfbmFtZSkge1xuXG4gICAgdGV4dCA9IFwiVGhhbmtzIFwiICsgcmVjZWl2ZWRfbWVzc2FnZTtcbiAgICBcbiAgfSBlbHNlIGlmICh1c2VyU3RhdGUgPT0gc3RhdGVzLmFza19maXJzdF9uYW1lKSB7XG4gICAgXG4gICAgdGV4dCA9IFwiVGhhbmtzIFwiICsgcmVjZWl2ZWRfbWVzc2FnZSArIFwiLiBOb3cgd2hhdCBpcyB5b3VyIHNlY29uZCBuYW1lP1wiO1xuICAgIHVzZXJzW3NlbmRlcl9wc2lkXS5maXJzdF9uYW1lID0gcmVjZWl2ZWRfbWVzc2FnZTtcbiAgICB1c2Vyc1tzZW5kZXJfcHNpZF0uc3RhdGUgPSBzdGF0ZXMuYXNrX2xhc3RfbmFtZTtcbiAgICBcbiAgfSBlbHNlIGlmICh1c2VyU3RhdGUgPT0gc3RhdGVzLmFza19sYXN0X25hbWUpIHtcbiAgICBcbiAgICB0ZXh0ID0gXCJBd2Vzb21lISBOb3cgYXJlIHlvdSBhIGdvbGRzbWl0aHMgc3R1ZGVudD9cIjtcbiAgICB1c2Vyc1tzZW5kZXJfcHNpZF0ubGFzdF9uYW1lID0gcmVjZWl2ZWRfbWVzc2FnZTtcbiAgICBcbiAgICBxdWlja1JlcGxpZXMgPSBbXG4gICAgICB7XG4gICAgICAgIGNvbnRlbnRfdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgIHRpdGxlOiBcIlllc1wiLFxuICAgICAgICBwYXlsb2FkOiBcIllFU19QQVlMT0FEXCJcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIGNvbnRlbnRfdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgIHRpdGxlOiBcIk5vXCIsXG4gICAgICAgIHBheWxvYWQ6IFwiTk9fUEFZTE9BRFwiXG4gICAgICB9XG4gICAgXVxuICAgIHVzZXJzW3NlbmRlcl9wc2lkXS5zdGF0ZSA9IHN0YXRlcy5jb25maXJtX2dvbGRzbWl0aHNfc3R1ZGVudDtcblxuICB9IGVsc2UgaWYgKHVzZXJTdGF0ZSA9PSBzdGF0ZXMuY29uZmlybV9zdHVkZW50X2lkKSB7XG4gICAgXG4gICAgdXNlcnNbc2VuZGVyX3BzaWRdLnN0dWRlbnRfaWQgPSByZWNlaXZlZF9tZXNzYWdlO1xuICAgIFxuICAgIHVzZXJzW3NlbmRlcl9wc2lkXS5zdGF0ZSA9IHN0YXRlcy5hc2tfZW1haWw7XG4gICAgXG4gICAgdGV4dCA9IGBUaGFua3MuIE5leHQgSSBuZWVkIHRvIGtub3cgeW91ciBlbWFpbCBhZGRyZXNzLCBwcmVmZXJlYWJseSB5b3VyIHN0dWRlbnQgb25lIHNvIHRoZXJlIGlzIGFuIGVhc3kgY29udGFjdCBtZXRob2QgaW4gdGhlIGNvcnJlc3BvZGFuY2UgSSBnZW5lcmF0ZSBmb3IgeW91LiBUbyBiZSBjbGVhciwgSSB3aWxsIG5vdCBzdG9yZSwgc2hhcmUgb3IgZXZlciBzZW5kIHlvdSBhbnl0aGluZyB2aWEgdGhpcyBlbWFpbCBhZGRyZXNzLlxcblxcblBsZWFzZSB3cml0ZSB5b3VyIGVtYWlsIGFkcmVzcyBkb3duIG5leHQuYDtcbiAgICBcbiAgfSBlbHNlIGlmICh1c2VyU3RhdGUgPT0gc3RhdGVzLmFza19ob3dfbXVjaF9jb3N0KSB7XG4gICAgXG4gICAgdXNlcnNbc2VuZGVyX3BzaWRdLnR1aXRpb25fZmVlID0gTnVtYmVyKHJlY2VpdmVkX21lc3NhZ2UpO1xuICAgIFxuICAgIGlmICghaXNOYU4odXNlcnNbc2VuZGVyX3BzaWRdLnR1aXRpb25fZmVlKSkge1xuICAgICAgXG4gICAgICBjb25zdCBkYXlzID0gdXNlcnNbc2VuZGVyX3BzaWRdLmFtb3VudF9kYXlzO1xuXG4gICAgICBjb25zdCBjb3N0ID0gbW9uZXlPd2VkKHVzZXJzW3NlbmRlcl9wc2lkXS50dWl0aW9uX2ZlZSwgZGF5cyk7XG4gICAgICB1c2Vyc1tzZW5kZXJfcHNpZF0uYW1vdW50X3JlaW1idXJzZSA9IGNvc3Q7XG5cbiAgICAgIHRleHQgPSBgVGhhbmtzIGFnYWluISBOZWFybHkgZG9uZSBub3cgOilcXG5cXG5gICtcbiAgICAgICAgICAgICBgSSBjYWxjdWxhdGUgdGhhdCAxNCBvdXQgb2YgeW91ciAke2RheXN9IGRheXMgYXQgeW91ciB0dWl0aW9uIGNvc3QgbWVhbnMgeW91IHNob3VsZCBiZSByZWluYnVyc2VkIMKjJHtjb3N0fS5cXG5cXG5gICsgXG4gICAgICAgICAgICAgYFdvdWxkIHlvdSBsaWtlIHRvIGFkZCB5b3VyIHNpZ25hdHVyZSB0byB0aGUgY29ycmVzcG9uZGFuY2U/IGAgK1xuICAgICAgICAgICAgIGAoQSBwb3AtdXAgd2lsbCBhcHBlYXIpYDtcbiAgICAgIHF1aWNrUmVwbGllcyA9IFsgXG4gICAgICAgIHtcbiAgICAgICAgICBjb250ZW50X3R5cGU6IFwidGV4dFwiLFxuICAgICAgICAgIHRpdGxlOiBcIlNvdW5kcyBjb29sIVwiLFxuICAgICAgICAgIHBheWxvYWQ6IFwiWUVTX1BBWUxPQURcIlxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgY29udGVudF90eXBlOiBcInRleHRcIixcbiAgICAgICAgICB0aXRsZTogXCJObyBUaGFua3NcIixcbiAgICAgICAgICBwYXlsb2FkOiBcIk5PX1BBWUxPQURcIlxuICAgICAgICB9XG4gICAgICBdO1xuXG4gICAgICB1c2Vyc1tzZW5kZXJfcHNpZF0uc3RhdGUgPSBzdGF0ZXMuY3JlYXRlX3NpZ25pdHVyZTtcbiAgICB9XG5cbiAgfSBlbHNlIGlmICh1c2VyU3RhdGUgPT0gc3RhdGVzLmFza19ob3dfbWFueV9kYXlzKSB7XG4gICAgXG4gICAgdXNlcnNbc2VuZGVyX3BzaWRdLmFtb3VudF9kYXlzID0gTnVtYmVyKHJlY2VpdmVkX21lc3NhZ2UpO1xuICAgIFxuICAgIGlmICghaXNOYU4odXNlcnNbc2VuZGVyX3BzaWRdLmFtb3VudF9kYXlzKSkge1xuICAgICAgXG4gICAgICB1c2Vyc1tzZW5kZXJfcHNpZF0uc3RhdGUgPSBzdGF0ZXMuYXNrX2hvd19tdWNoX2Nvc3Q7XG5cbiAgICAgIHRleHQgPSBcIkdyZWF0IHRoYW5rcyBmb3IgdGhhdC5cXG5cXG5cIiArXG4gICAgICAgICAgICAgXCJOZXh0LCBob3cgbXVjaCBpcyB0aGUgdHV0aW9uIGZlZXMgZm9yIHRoaXMgYWNhZGVtaWMgeWVhcj9cXG5cXG5cIiArIFxuICAgICAgICAgICAgIFwiU2VsZWN0IGVpdGhlciBhIGN1c3RvbSBhbW91bnQgKGluIEdCUCDCoykgb3IgdGhlIGRlZmF1bHQsIMKjOTAwMC5cIjtcbiAgICAgIHF1aWNrUmVwbGllcyA9IFtcbiAgICAgICAge1xuICAgICAgICAgIGNvbnRlbnRfdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgdGl0bGU6IFwiRGVmYXVsdCDCozkwMDBcIixcbiAgICAgICAgICBwYXlsb2FkOiBcIkRFRkFVTFRfUEFZTE9BRFwiXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBjb250ZW50X3R5cGU6IFwidGV4dFwiLFxuICAgICAgICAgIHRpdGxlOiBcIkN1c3RvbVwiLFxuICAgICAgICAgIHBheWxvYWQ6IFwiQ1VTVE9NX1BBWUxPQURcIlxuICAgICAgICB9XG4gICAgICBdO1xuICAgIH1cbiAgfSBlbHNlIGlmICh1c2VyU3RhdGUgPT0gc3RhdGVzLmFza19lbWFpbCkge1xuICAgIFxuICAgIHVzZXJzW3NlbmRlcl9wc2lkXS5lbWFpbF9hZGRyZXNzID0gcmVjZWl2ZWRfbWVzc2FnZTtcbiAgICBcbiAgICBpZiAodmFsaWRhdG9yLnZhbGlkYXRlKHVzZXJzW3NlbmRlcl9wc2lkXS5lbWFpbF9hZGRyZXNzKSkge1xuICAgICAgXG4gICAgICB1c2Vyc1tzZW5kZXJfcHNpZF0uc3RhdGUgPSBzdGF0ZXMuYXNrX2hvd19tYW55X2RheXM7XG5cbiAgICAgIHRleHQgPSBgV2Ugd2lsbCBub3cgbmVlZCB0byB3b3JrIG91dCBob3cgbXVjaCB5b3UgYXJlIG93ZWQuXFxuXFxuYCArXG4gICAgICAgICAgICAgYEZvciBub3csIHdlIHdpbGwgd29yayBvdXQgdGhlIGAgK1xuICAgICAgICAgICAgIGBmcmFjdGlvbiBvZiB0dXRpb24gZmVlIHRoYXQgeW91IGhhdmUgc3BlbnQgbm90IGFjY2Vzc2luZyB0aGUgYCArXG4gICAgICAgICAgICAgYHVuaXZlcnNpdGllcyBmYWNpbGl0aWVzIGR1cmluZyB0aGUgMTQgZGF5IHN0cmlrZS4gRmlyc3RseSwgd2UgYCArXG4gICAgICAgICAgICAgYG5lZWQgdG8ga25vdyBob3cgbWFueSBkYXlzIHRoZXJlIGFyZSBpbiB5b3VyIGFjYWRlbWljIHllYXIuIE9uIGAgK1xuICAgICAgICAgICAgIGBhdmVyYWdlIChhbmQgdGhpcyBpcyBhIGNvbnNlcnZhdGl2ZSBlc3RpbWF0ZSkgdGhlcmUgYXJlIDE3MC5cXG5cXG5gICtcbiAgICAgICAgICAgICBgV291bGQgeW91IGxpa2UgdG8gdXNlIHRoZSBkZWZhdWx0IDE3MCBkYXlzIG9yIHdvdWxkIHlvdSBsaWtlIHRvIGAgK1xuICAgICAgICAgICAgIGBlbnRlciBhIGN1c3RvbSBhbW91bnQ/YDtcblxuICAgICAgcXVpY2tSZXBsaWVzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgY29udGVudF90eXBlOiBcInRleHRcIixcbiAgICAgICAgICB0aXRsZTogXCJEZWZhdWx0XCIsXG4gICAgICAgICAgcGF5bG9hZDogXCJERUZBVUxUX1BBWUxPQURcIlxuICAgICAgICB9LFxuICAgICAgICB7XG4gICAgICAgICAgY29udGVudF90eXBlOiBcInRleHRcIixcbiAgICAgICAgICB0aXRsZTogXCJDdXN0b21cIixcbiAgICAgICAgICBwYXlsb2FkOiBcIkNVU1RPTV9QQVlMT0FEXCJcbiAgICAgICAgfVxuICAgICAgXTtcbiAgICB9XG4gIH1cbiAgXG4gIGxldCByZXNwb25zZSA9IHsgdGV4dDogdGV4dCB9O1xuICBcbiAgaWYgKHF1aWNrUmVwbGllcyAhPSBudWxsKSB7XG4gICAgcmVzcG9uc2UucXVpY2tfcmVwbGllcyA9IHF1aWNrUmVwbGllcztcbiAgfVxuICBcbiAgcmV0dXJuIHJlc3BvbnNlO1xufVxuXG5cbmZ1bmN0aW9uIGhhbmRsZVF1aWNrUmVwbHkoc2VuZGVyX3BzaWQsIHJlY2VpdmVkX3JlcGx5KSB7XG4gIFxuICBsZXQgcGF5bG9hZCA9IHJlY2VpdmVkX3JlcGx5LnBheWxvYWQ7XG4gIGxldCByZXNwb25zZTtcbiAgXG4gIGlmIChwYXlsb2FkID09PSAnWUVTX1BBWUxPQUQnKSB7XG4gICAgICAgXG4gICAgaWYgKHVzZXJzW3NlbmRlcl9wc2lkXS5zdGF0ZSA9PSBzdGF0ZXMuY29uZmlybV9uYW1lKSB7XG4gICAgICBcbiAgICAgIHJlc3BvbnNlID0gZ2V0WWVzTm9RdWlja1F1ZXN0aW9uKFwiR3JlYXQsIHRoYW5rcyEgTm93LCBhcmUgeW91IGEgR29sZHNtaXRocyBzdHVkZW50P1wiKTtcbiAgICAgIFxuICAgICAgdXNlcnNbc2VuZGVyX3BzaWRdLnN0YXRlID0gc3RhdGVzLmNvbmZpcm1fZ29sZHNtaXRoc19zdHVkZW50O1xuXG4gICAgfSBlbHNlIGlmICh1c2Vyc1tzZW5kZXJfcHNpZF0uc3RhdGUgPT0gc3RhdGVzLmNvbmZpcm1fZ29sZHNtaXRoc19zdHVkZW50KSB7XG4gICAgICBcbiAgICAgIHJlc3BvbnNlID0ge1xuICAgICAgICBcInRleHRcIjogXCJPa2F5IGdyZWF0LCB0aGFua3MhIENhbiB5b3UgbmV4dCB0ZWxsIG1lIHdoYXQgeW91ciBzdHVkZW50IElEIG51bWJlciBpcz9cIlxuICAgICAgfVxuICAgICAgXG4gICAgICB1c2Vyc1tzZW5kZXJfcHNpZF0udW5pdmVyc2l0eSA9IFwiZ29sZHNtaXRoc1wiOyAgICAgIFxuICAgICAgdXNlcnNbc2VuZGVyX3BzaWRdLnN0YXRlID0gc3RhdGVzLmNvbmZpcm1fc3R1ZGVudF9pZDtcbiAgICAgIFxuICAgIH0gZWxzZSBpZiAodXNlcnNbc2VuZGVyX3BzaWRdLnN0YXRlID09IHN0YXRlcy5jcmVhdGVfc2lnbml0dXJlKSB7XG4gICAgICBcbiAgICAgIHJlc3BvbnNlID0ge1xuICAgICAgICBhdHRhY2htZW50OiB7XG4gICAgICAgICAgdHlwZTogXCJ0ZW1wbGF0ZVwiLFxuICAgICAgICAgIHBheWxvYWQ6IHtcbiAgICAgICAgICAgIHRlbXBsYXRlX3R5cGU6IFwiYnV0dG9uXCIsXG4gICAgICAgICAgICB0ZXh0OiBcIkRyYXcgeW91ciBzaWduaXR1cmUhXCIsXG4gICAgICAgICAgICBidXR0b25zOiBbXG4gICAgICAgICAgICAgIHtcbiAgICAgICAgICAgICAgICB0eXBlOiBcIndlYl91cmxcIixcbiAgICAgICAgICAgICAgICB1cmw6IGBodHRwczovL2dyYXRlZnVsLWR1Y2tsaW5nLmdsaXRjaC5tZT8ke3NlbmRlcl9wc2lkfWAsXG4gICAgICAgICAgICAgICAgdGl0bGU6IFwiU3RhcnQgaGVyZVwiLFxuICAgICAgICAgICAgICAgIHdlYnZpZXdfaGVpZ2h0X3JhdGlvOiBcInRhbGxcIixcbiAgICAgICAgICAgICAgICBtZXNzZW5nZXJfZXh0ZW5zaW9uczogXCJ0cnVlXCIsICBcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgXVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfTtcbiAgICB9XG4gICAgXG4gIH0gZWxzZSBpZiAocGF5bG9hZCA9PT0gJ05PX1BBWUxPQUQnKSB7XG4gICAgXG4gICAgaWYgKHVzZXJzW3NlbmRlcl9wc2lkXS5zdGF0ZSA9PSBzdGF0ZXMuY29uZmlybV9uYW1lKSB7XG4gICAgICBcbiAgICAgIHJlc3BvbnNlID0ge1xuICAgICAgICB0ZXh0OiBcIk9rYXkgbm8gcHJvYmxlbSEgUGxlYXNlIHRlbGwgbWUgeW91ciBmaXJzdCBuYW1lLlwiXG4gICAgICB9XG4gICAgICBcbiAgICAgIHVzZXJzW3NlbmRlcl9wc2lkXS5zdGF0ZSA9IHN0YXRlcy5hc2tfZmlyc3RfbmFtZTtcbiAgICBcbiAgICB9IGVsc2UgaWYgKHVzZXJzW3NlbmRlcl9wc2lkXS5zdGF0ZSA9PSBzdGF0ZXMuY29uZmlybV9nb2xkc21pdGhzX3N0dWRlbnQpIHtcbiAgICAgIFxuICAgICAgcmVzcG9uc2UgPSB7XG4gICAgICAgIHRleHQ6IFwiT2theSBubyBwcm9ibGVtISBKdXN0IGJlIGF3YXJlIHRoYXQgdGhpcyBjaGF0Ym90IGFuZCB0aGUgZnVuY3Rpb25hbGl0eSBpcyBpbiBhbiBhbHBoYSBzdGFnZSB3aXRoIEdvbGRzbWl0aHMgc3R1ZGVudHMgaW4gbWluZCwgc28gdGhlcmUgbWF5IGJlIGEgZmV3IGVsZW1lbnRzIHRoYXQgYXJlIG5vdCBjdXJyZW50bHkgYXZhaWxhYmxlIHRvIHlvdS4gSWYgeW91IGhhdmUgZmVhdHVyZSByZXF1ZXN0cyBwbGVhc2UgbGVhdmUgbWVzc2FnZXMgb24gbXkgZmFjZWJvb2sgcGFnZSEgOilcXG5cXG5Pa2F5IG5leHQgcXVlc3Rpb24gLSB3aGF0IGlzIHlvdXIgc3R1ZGVudCBJRCBudW1iZXI/XCJcbiAgICAgIH1cblxuICAgICAgdXNlcnNbc2VuZGVyX3BzaWRdLnVuaXZlcnNpdHkgPSBcIm90aGVyXCI7XG4gICAgICB1c2Vyc1tzZW5kZXJfcHNpZF0uc3RhdGUgPSBzdGF0ZXMuY29uZmlybV9zdHVkZW50X2lkO1xuICAgIFxuICAgIH0gZWxzZSBpZiAodXNlcnNbc2VuZGVyX3BzaWRdLnN0YXRlID09IHN0YXRlcy5jcmVhdGVfc2lnbml0dXJlKSB7XG4gICAgICBcbiAgICAgIHVzZXJzW3NlbmRlcl9wc2lkXS5zaWduYXR1cmVfZXhpc3RzID0gZmFsc2U7XG4gICAgICB1c2Vyc1tzZW5kZXJfcHNpZF0uc3RhdGUgPSBzdGF0ZXMuYXNrX2RhdGFfZm9ybWF0O1xuICAgICAgcmVzcG9uc2UgPSB7XG5cbiAgICAgICAgdGV4dDogJ05vIHByb2JsZW0hIEZvciBub3cgSSB3aWxsIG9ubHkgc3VwcG9ydCByZW5kZXJpbmcgeW91ciBsZXR0ZXIgYXMgYSBQREYgLSBidXQgbW9yZSBmZWF0dXJlcyBhcmUgY29taW5nIHNvb24hIFBsZWFzZSBzZWxlY3QgUERGIGJlbG93IHRvIGNvbnRpbnVlIDopJyxcblxuICAgICAgICBxdWlja19yZXBsaWVzOiBbXG4gICAgICAgICAge1xuICAgICAgICAgICAgY29udGVudF90eXBlOiBcInRleHRcIixcbiAgICAgICAgICAgIHRpdGxlOiBcIlBERlwiLFxuICAgICAgICAgICAgcGF5bG9hZDogXCJMQVRFWF9QQVlMT0FEXCJcbiAgICAgICAgICB9XG4gICAgICAgIF0sXG4gICAgXG4gICAgICB9O1xuICAgICAgXG4gICAgfVxuICAgIFxuICB9IGVsc2UgaWYgKHBheWxvYWQgPT09ICdDVVNUT01fUEFZTE9BRCcpIHtcbiAgICBcbiAgICBpZiAodXNlcnNbc2VuZGVyX3BzaWRdLnN0YXRlID09IHN0YXRlcy5hc2tfaG93X21hbnlfZGF5cykge1xuICAgICAgcmVzcG9uc2UgPSB7XG4gICAgICAgIHRleHQ6IFwiUGxlYXNlIHdyaXRlIGluIG51bWJlcnMgaG93IG1hbnkgZGF5cyB5b3UgaGF2ZSBpbiB5b3VyIGFjYWRlbWljIHllYXIuXCJcbiAgICAgIH1cbiAgICBcbiAgICB9IGVsc2UgaWYgKHVzZXJzW3NlbmRlcl9wc2lkXS5zdGF0ZSA9PSBzdGF0ZXMuYXNrX2hvd19tdWNoX2Nvc3QpIHtcbiAgICAgIHJlc3BvbnNlID0ge1xuICAgICAgICB0ZXh0OiBcIlBsZWFzZSB3cml0ZSBpbiBudW1iZXJzIGhvdyBtdWNoIGluIGJyaXRpc2ggcG91bmQgc3RlcmxpbmcgwqMgeW91ciBhbm51YWwgdHVpdGlvbiBmZWUgaXMuXCJcbiAgICAgIH1cbiAgICBcbiAgICB9XG4gICAgXG4gIH0gZWxzZSBpZiAocGF5bG9hZCA9PT0gJ0RFRkFVTFRfUEFZTE9BRCcpIHtcbiAgICBcbiAgICBpZiAodXNlcnNbc2VuZGVyX3BzaWRdLnN0YXRlID09IHN0YXRlcy5hc2tfaG93X21hbnlfZGF5cykge1xuICAgICAgXG4gICAgICB1c2Vyc1tzZW5kZXJfcHNpZF0uYW1vdW50X2RheXMgPSAxNzA7XG4gICAgICBcbiAgICAgIGxldCB0ZXh0ID0gXCJHcmVhdCB0aGFua3MgZm9yIHRoYXQuXFxuXFxuXCIgK1xuICAgICAgICAgICAgICAgICBcIk5leHQsIGhvdyBtdWNoIGlzIHRoZSB0dXRpb24gZmVlcyBmb3IgdGhpcyBhY2FkZW1pYyB5ZWFyP1xcblxcblwiICsgXG4gICAgICAgICAgICAgICAgIFwiU2VsZWN0IGVpdGhlciBhIGN1c3RvbSBhbW91bnQgKGluIEdCUCDCoykgb3IgdGhlIGRlZmF1bHQsIMKjOTAwMC5cIjtcbiAgICAgIGxldCByZXBsaWVzID0gW1xuICAgICAgICB7XG4gICAgICAgICAgY29udGVudF90eXBlOiBcInRleHRcIixcbiAgICAgICAgICB0aXRsZTogXCJEZWZhdWx0IMKjOTAwMFwiLFxuICAgICAgICAgIHBheWxvYWQ6IFwiREVGQVVMVF9QQVlMT0FEXCJcbiAgICAgICAgfSxcbiAgICAgICAge1xuICAgICAgICAgIGNvbnRlbnRfdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgdGl0bGU6IFwiQ3VzdG9tXCIsXG4gICAgICAgICAgcGF5bG9hZDogXCJDVVNUT01fUEFZTE9BRFwiXG4gICAgICAgIH1cbiAgICAgIF07XG4gICAgICByZXNwb25zZSA9IGdldFF1aWNrUXVlc3Rpb24odGV4dCwgcmVwbGllcyk7XG4gICAgICB1c2Vyc1tzZW5kZXJfcHNpZF0uc3RhdGUgPSBzdGF0ZXMuYXNrX2hvd19tdWNoX2Nvc3Q7XG4gICAgICBcbiAgICB9IGVsc2UgaWYgKHVzZXJzW3NlbmRlcl9wc2lkXS5zdGF0ZSA9PSBzdGF0ZXMuYXNrX2hvd19tdWNoX2Nvc3QpIHtcbiAgICBcbiAgICAgIGNvbnN0IHR1aXRpb25GZWUgPSA5MDAwO1xuICAgICAgdXNlcnNbc2VuZGVyX3BzaWRdLnR1aXRpb25fZmVlID0gdHVpdGlvbkZlZTtcbiAgICAgIGNvbnN0IGRheXMgPSB1c2Vyc1tzZW5kZXJfcHNpZF0uYW1vdW50X2RheXM7XG5cbiAgICAgIGNvbnN0IGNvc3QgPSBtb25leU93ZWQodHVpdGlvbkZlZSwgZGF5cyk7XG4gICAgICB1c2Vyc1tzZW5kZXJfcHNpZF0uYW1vdW50X3JlaW1idXJzZSA9IGNvc3Q7XG4gICAgICAvLyBJIGNhbGN1bGF0ZSB0aGF0IDE0IG91dCBvZiB5b3VyICR7ZGF5c30gZGF5cyBhdCB5b3VyIHR1aXRpb24gY29zdCBtZWFucyB5b3Ugc2hvdWxkIGJlIFxuICAgICAgbGV0IHRleHQgPSBgVGhhbmtzIGFnYWluISBOZWFybHkgZG9uZSBub3cgOilcXG5cXG5gICtcbiAgICAgICAgICAgICAgICAgYEkgY2FsY3VsYXRlIHRoYXQgMTQgb3V0IG9mIHlvdXIgJHtkYXlzfSBkYXlzIGF0IHlvdXIgdHVpdGlvbiBjb3N0IG1lYW5zIHlvdSBzaG91bGQgYmUgcmVpbmJ1cnNlZCDCoyR7Y29zdH0uXFxuXFxuYCArIFxuICAgICAgICAgICAgICAgICBgU2lnbmF0dXJlcyBjYW4gaGVscCBpbXByb3ZlIHRoZSBhdXRoZW50aWNpdHkgb2YgZG9jdW1lbnRzLiBXb3VsZCB5b3UgbGlrZSB0byBhZGQgeW91ciBzaWduYXR1cmUgdG8gdGhlIGdlbmVyYXRlZCBjb3JyZXNwb25kYW5jZT8gYDtcbiAgICAgIGxldCByZXBsaWVzID0gWyBcbiAgICAgICAge1xuICAgICAgICAgIGNvbnRlbnRfdHlwZTogXCJ0ZXh0XCIsXG4gICAgICAgICAgdGl0bGU6IFwiWWVzXCIsXG4gICAgICAgICAgcGF5bG9hZDogXCJZRVNfUEFZTE9BRFwiXG4gICAgICAgIH0sXG4gICAgICAgIHtcbiAgICAgICAgICBjb250ZW50X3R5cGU6IFwidGV4dFwiLFxuICAgICAgICAgIHRpdGxlOiBcIk5vXCIsXG4gICAgICAgICAgcGF5bG9hZDogXCJOT19QQVlMT0FEXCJcbiAgICAgICAgfVxuICAgICAgXTtcbiAgICAgIHJlc3BvbnNlID0gZ2V0UXVpY2tRdWVzdGlvbih0ZXh0LCByZXBsaWVzKTtcbiAgICAgIHVzZXJzW3NlbmRlcl9wc2lkXS5zdGF0ZSA9IHN0YXRlcy5jcmVhdGVfc2lnbml0dXJlO1xuICAgIFxuICAgIH0gXG4gIH0gZWxzZSBpZiAocGF5bG9hZCA9PT0gJ0xBVEVYX1BBWUxPQUQnKSB7XG4gIFxuICAgIGNvbnN0IGlzR29sZHNtaXRocyA9IHVzZXJzW3NlbmRlcl9wc2lkXS51bml2ZXJzaXR5ID09IFwiZ29sZHNtaXRoc1wiO1xuICAgIFxuICAgIC8vIENyZWF0ZSB0aGUgbGF0ZXggZmlsZSBmcm9tIHRlbXBsYXRlIGFuZCB1c2VyIGRhdGEuXG4gICAgY29uc3QgbGF0ZXhTdHJpbmcgPSBnb2xkc21pdGhzLmdlbmVyYXRlTGF0ZXhGaWxlKHNlbmRlcl9wc2lkLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcnNbc2VuZGVyX3BzaWRdLmZpcnN0X25hbWUsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2Vyc1tzZW5kZXJfcHNpZF0ubGFzdF9uYW1lLCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdXNlcnNbc2VuZGVyX3BzaWRdLmVtYWlsX2FkZHJlc3MsIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2Vyc1tzZW5kZXJfcHNpZF0uc3R1ZGVudF9pZCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJzW3NlbmRlcl9wc2lkXS50dWl0aW9uX2ZlZSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJzW3NlbmRlcl9wc2lkXS5hbW91bnRfZGF5cywgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHVzZXJzW3NlbmRlcl9wc2lkXS5hbW91bnRfcmVpbWJ1cnNlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB1c2Vyc1tzZW5kZXJfcHNpZF0uc2lnbmF0dXJlX2V4aXN0cyxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXNHb2xkc21pdGhzKTtcblxuICAgIGZzLndyaXRlRmlsZShgLi9wdWJsaWMvJHtzZW5kZXJfcHNpZH0udGV4YCwgbGF0ZXhTdHJpbmcsIGZ1bmN0aW9uKGVycikge1xuICAgICAgaWYgKGVycikge1xuICAgICAgICByZXR1cm4gY29uc29sZS5sb2coZXJyKTtcbiAgICAgIH1cbiAgICAgIFxuICAgICAgbGV0IHNoZWxsO1xuICAgICAgaWYgKHVzZXJzW3NlbmRlcl9wc2lkXS5zaWduYXR1cmVfZXhpc3RzKSB7XG4gICAgICAgIHNoZWxsID0gYC4vbGF0b24gcHVibGljLyR7c2VuZGVyX3BzaWR9LnRleCBwdWJsaWMvJHtzZW5kZXJfcHNpZH0ucG5nICYmIG12ICR7c2VuZGVyX3BzaWR9LnBkZiBwdWJsaWMvYDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNoZWxsID0gYC4vbGF0b24gcHVibGljLyR7c2VuZGVyX3BzaWR9LnRleCAmJiBtdiAke3NlbmRlcl9wc2lkfS5wZGYgcHVibGljL2BcbiAgICAgIH1cbiAgICAgIFxuICAgICAgLy8gVXNlIGxhdG9uIGFuZCB3YWl0IGZvciBwZGYgdG8gZXhpc3QuXG4gICAgICBjb25zdCB7IHN0ZG91dCwgc3RkZXJyLCBjb2RlIH0gPSBzaC5leGVjKHNoZWxsLCB7IHNpbGVudDogdHJ1ZSB9KTtcbiAgICAgIFxuICAgICAgY29uc3QgbWFpbE9wdGlvbnMgPSB7XG4gICAgICAgIGZyb206IHByb2Nlc3MuZW52LkdNQUlMX0FERFJFU1MsIC8vIHNlbmRlciBhZGRyZXNzXG4gICAgICAgIHRvOiB1c2Vyc1tzZW5kZXJfcHNpZF0uZW1haWxfYWRkcmVzcywgLy8gbGlzdCBvZiByZWNlaXZlcnNcbiAgICAgICAgc3ViamVjdDogJ1lvdXIgdHVpdGlvbiBmZWUgcmVjbGFpbWF0aW9uIGxldHRlcicsIC8vIFN1YmplY3QgbGluZVxuICAgICAgICBodG1sOiAnPHA+SGkhIFBsZWFzZSBmaW5kIGF0dGFjaGVkIHlvdXIgdHVpdGlvbiBmZWUgbGV0dGVyLiBNYWtlIHN1cmUgeW91IHNlbmQgaXQgdG8gdGhlIHJpZ2h0IHBlb3BsZSE8L3A+JywvLyBwbGFpbiB0ZXh0IGJvZHlcbiAgICAgICAgYXR0YWNobWVudHM6IFt7XG4gICAgICAgICAgZmlsZW5hbWU6IFwibGV0dGVyLnBkZlwiLFxuICAgICAgICAgIHBhdGg6IGBwdWJsaWMvJHtzZW5kZXJfcHNpZH0ucGRmYFxuICAgICAgICB9XVxuICAgICAgfTtcbiAgICAgIC8vIFNlbmQgYXMgYXR0YWNobWVudC5cbiAgICAgIC8vIFNlbmQgdGhlIEhUVFAgcmVxdWVzdCB0byB0aGUgTWVzc2VuZ2VyIFBsYXRmb3JtXG4gICAgICB0cmFuc3BvcnRlci5zZW5kTWFpbChtYWlsT3B0aW9ucywgZnVuY3Rpb24gKGVyciwgaW5mbykge1xuICAgICAgICBpZiAodmVyYm9zZSlcbiAgICAgICAgICBjb25zb2xlLmxvZyhpbmZvKTtcbiAgICAgICAgXG4gICAgICAgIC8vIENsZWFuIHVwXG4gICAgICAgIGZzLnVubGluayhgLi9wdWJsaWMvJHtzZW5kZXJfcHNpZH0ucGRmYCwgKGVycikgPT4ge1xuICAgICAgICAgIGlmICh2ZXJib3NlKVxuICAgICAgICAgICAgY29uc29sZS5sb2coYC4vcHVibGljLyR7c2VuZGVyX3BzaWR9LnBkZiB3YXMgZGVsZXRlZGApO1xuICAgICAgICB9KTtcbiAgICAgICAgZnMudW5saW5rKGAuL3B1YmxpYy8ke3NlbmRlcl9wc2lkfS50ZXhgLCAoZXJyKSA9PiB7XG4gICAgICAgICAgaWYgKHZlcmJvc2UpXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgLi9wdWJsaWMvJHtzZW5kZXJfcHNpZH0udGV4IHdhcyBkZWxldGVkYCk7XG4gICAgICAgIH0pO1xuICAgICAgICBpZiAodXNlcnNbc2VuZGVyX3BzaWRdLnNpZ25hdHVyZV9leGlzdHMpIHtcbiAgICAgICAgICBmcy51bmxpbmsoYC4vcHVibGljLyR7c2VuZGVyX3BzaWR9LnBuZ2AsIChlcnIpID0+IHtcbiAgICAgICAgICAgIGlmICh2ZXJib3NlKVxuICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgLi9wdWJsaWMvJHtzZW5kZXJfcHNpZH0ucG5nIHdhcyBkZWxldGVkYCk7XG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuXG4gICAgfSk7IFxuICAgIFxuICAgIHJlc3BvbnNlID0ge1xuICAgICAgICBcInRleHRcIjogXCJBd2Vzb21lISBJJ20ganVzdCBnZW5lcmF0aW5nIHlvdXIgZG9jdW1lbnQgYW5kIGEgbGluayB3aWxsIGJlIHNlbnQgdG8gdGhlIGVtYWlsIGFkcmVzcyB5b3Ugc3VwcGxpZWQgZWFybGllciEgSWYgeW91IHdvdWxkIGxpa2UgdG8gdXNlIG15IHNlcnZpY2UgYWdhaW4sIHBsZWFzZSBzZWxlY3QgJ3N0YXJ0IGFnYWluJyBmcm9tIHRoZSBtZW51IGJlbG93IDopXCJcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlc3BvbnNlO1xufVxuXG5mdW5jdGlvbiBtb25leU93ZWQodHVpdGlvbl9jb3N0LCBhbW91bnRfZGF5cykge1xuICBcbiAgY29uc3QgZnJhY3Rpb25EYXlzID0gMTQgLyBhbW91bnRfZGF5cztcbiAgY29uc3QgZnJhY3Rpb25Db3N0ID0gZnJhY3Rpb25EYXlzICogdHVpdGlvbl9jb3N0O1xuICByZXR1cm4gTWF0aC5mbG9vcihmcmFjdGlvbkNvc3QpO1xufVxuXG4vLyBIYW5kbGVzIG1lc3NhZ2VzIGV2ZW50c1xuZnVuY3Rpb24gaGFuZGxlTWVzc2FnZShzZW5kZXJfcHNpZCwgcmVjZWl2ZWRfbWVzc2FnZSkge1xuICBcbiAgbGV0IHJlc3BvbnNlO1xuXG4gIC8vIENoZWNrIGlmIHRoZSBtZXNzYWdlIGlzIGEgcXVpY2sgcmVwbHkuXG4gIGlmIChyZWNlaXZlZF9tZXNzYWdlLnF1aWNrX3JlcGx5KSB7XG4gICAgXG4gICAgcmVzcG9uc2UgPSBoYW5kbGVRdWlja1JlcGx5KHNlbmRlcl9wc2lkLCByZWNlaXZlZF9tZXNzYWdlLnF1aWNrX3JlcGx5KTtcbiAgICBcbiAgfSBlbHNlICBpZiAocmVjZWl2ZWRfbWVzc2FnZS50ZXh0KSB7ICAgICAgXG4gICAgXG4gICAgcmVzcG9uc2UgPSBoYW5kbGVUZXh0TWVzc2FnZShzZW5kZXJfcHNpZCwgcmVjZWl2ZWRfbWVzc2FnZS50ZXh0KTsgICBcbiAgfVxuICBcbiAgbGV0IGlzU2lnID0gdHJ1ZTtcbiAgXG4gIHRyeSB7XG4gICAgaWYgKHJlc3BvbnNlLmF0dGFjaG1lbnQucGF5bG9hZC50ZXh0ICE9ICdEcmF3IHlvdXIgc2lnbml0dXJlIScpIHtcbiAgICAgIGlzU2lnID0gZmFsc2U7XG4gICAgfVxuICB9IGNhdGNoIChlKSB7XG4gICAgaXNTaWcgPSBmYWxzZTtcbiAgfVxuXG4gIGlmIChyZXNwb25zZS50ZXh0ID09IHVuZGVmaW5lZCAmJiAhaXNTaWcpXG4gICAgcmVwZWF0TGFzdG1lc3NhZ2Uoc2VuZGVyX3BzaWQpO1xuICBcbiAgZWxzZVxuICAgIC8vIFNlbmRzIHRoZSByZXNwb25zZSBtZXNzYWdlXG4gICAgY2FsbFNlbmRBUEkoc2VuZGVyX3BzaWQsIHJlc3BvbnNlKTsgIFxufVxuXG4vLyBIYW5kbGVzIG1lc3NhZ2luZ19wb3N0YmFja3MgZXZlbnRzXG5mdW5jdGlvbiBoYW5kbGVQb3N0YmFjayhzZW5kZXJfcHNpZCwgcmVjZWl2ZWRfcG9zdGJhY2spIHtcbiAgXG4gIGxldCByZXNwb25zZTtcbiAgXG4gIC8vIEdldCB0aGUgcGF5bG9hZCBmb3IgdGhlIHBvc3RiYWNrXG4gIGxldCBwYXlsb2FkID0gcmVjZWl2ZWRfcG9zdGJhY2sucGF5bG9hZDtcblxuICAvLyBTZXQgdGhlIHJlc3BvbnNlIGJhc2VkIG9uIHRoZSBwb3N0YmFjayBwYXlsb2FkXG4gIGlmIChwYXlsb2FkID09PSAnR3JlZXRpbmcnIHx8IHBheWxvYWQgPT0gJ1NUQVJUX0FHQUlOX1BBWUxPQUQnKSB7XG4gICAgXG4gICAgdXNlcnNbc2VuZGVyX3BzaWRdID0ge307XG4gICAgZ2V0Rmlyc3RNZXNzYWdlKHNlbmRlcl9wc2lkKS50aGVuKHQgPT4ge1xuICAgICAgXG4gICAgICByZXNwb25zZSA9IGdldFllc05vUXVpY2tRdWVzdGlvbih0KTtcbiAgICAgIFxuICAgICAgY2FsbFNlbmRBUEkoc2VuZGVyX3BzaWQsIHJlc3BvbnNlKTtcbiAgICB9KTtcblxuICB9IGVsc2UgaWYgKHBheWxvYWQgPT09ICdDT05UQUNUX1BBWUxPQUQnKSB7XG4gICAgXG4gICAgY29uc3QgbWVzc2FnZSA9IHVzZXJzW3NlbmRlcl9wc2lkXS5sYXN0X21lc3NhZ2U7XG4gICAgXG4gICAgLy8gQ29uc3RydWN0IHRoZSBtZXNzYWdlIGJvZHlcbiAgICBsZXQgcmVxdWVzdF9ib2R5ID0ge1xuICAgICAgcmVjaXBpZW50OiB7XG4gICAgICAgIGlkOiBzZW5kZXJfcHNpZFxuICAgICAgfSxcbiAgICAgIG1lc3NhZ2U6IHsgdGV4dDogY29udGFjdCgpIH1cbiAgICB9XG5cbiAgICAvLyBTZW5kIHRoZSBIVFRQIHJlcXVlc3QgdG8gdGhlIE1lc3NlbmdlciBQbGF0Zm9ybVxuICAgIHJlcXVlc3Qoe1xuICAgICAgdXJpOiBcImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YyLjYvbWUvbWVzc2FnZXNcIixcbiAgICAgIHFzOiB7IGFjY2Vzc190b2tlbjogUEFHRV9BQ0NFU1NfVE9LRU4gfSxcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBqc29uOiByZXF1ZXN0X2JvZHlcbiAgICB9LCAoZXJyLCByZXMsIGJvZHkpID0+IHtcbiAgICAgIGlmICghZXJyKSB7XG4gICAgICAgIGlmICh2ZXJib3NlKSBjb25zb2xlLmxvZygnbWVzc2FnZSBzZW50IScpXG4gICAgICAgIFxuICAgICAgICBjYWxsU2VuZEFQSShzZW5kZXJfcHNpZCwgbWVzc2FnZS5yZXNwb25zZSwgbWVzc2FnZS5maWxlX2RhdGEpO1xuICAgICAgICBcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmFibGUgdG8gc2VuZCBtZXNzYWdlOlwiICsgZXJyKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSBcbn1cblxuZnVuY3Rpb24gd3JpdGVVc2VycygpIHtcbiAgdmFyIHN0cmluZyA9IEpTT04uc3RyaW5naWZ5KHVzZXJzLCBudWxsLCAyKTtcbiAgZnMud3JpdGVGaWxlKCdkYi5qc29uJywgc3RyaW5nLCAndXRmOCcsIChlcnIpID0+IHtcbiAgICBpZiAoZXJyKSBjb25zb2xlLmxvZyhlcnIpO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcmVhZFVzZXJzKCkge1xuICBmcy5yZWFkRmlsZSgnZGIuanNvbicsICd1dGY4JywgKGVyciwgZmlsZUNvbnRlbnQpID0+IHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBjb25zb2xlLmxvZyhlcnIpO1xuICAgIH0gZWxzZSB7XG4gICAgICB1c2VycyA9IEpTT04ucGFyc2UoZmlsZUNvbnRlbnQudG9TdHJpbmcoKSk7XG4gICAgICBpZiAodmVyYm9zZSlcbiAgICAgICAgY29uc29sZS5sb2codXNlcnMpO1xuICAgIH1cbiAgfSk7XG59XG5cblxuLy8gU2VuZHMgcmVzcG9uc2UgbWVzc2FnZXMgdmlhIHRoZSBTZW5kIEFQSVxuZnVuY3Rpb24gY2FsbFNlbmRBUEkoc2VuZGVyX3BzaWQsIHJlc3BvbnNlLCBmaWxlX2RhdGE9bnVsbCkge1xuICAvLyBDb25zdHJ1Y3QgdGhlIG1lc3NhZ2UgYm9keVxuICBsZXQgcmVxdWVzdF9ib2R5ID0ge1xuICAgIHJlY2lwaWVudDoge1xuICAgICAgaWQ6IHNlbmRlcl9wc2lkXG4gICAgfSxcbiAgICBtZXNzYWdlOiByZXNwb25zZVxuICB9XG4gIFxuICBpZiAoZmlsZV9kYXRhICE9IG51bGwpIHtcbiAgICByZXF1ZXN0X2JvZHkuZmlsZWRhdGEgPSBmaWxlX2RhdGE7XG4gIH1cblxuICAvLyBTZW5kIHRoZSBIVFRQIHJlcXVlc3QgdG8gdGhlIE1lc3NlbmdlciBQbGF0Zm9ybVxuICByZXF1ZXN0KHtcbiAgICB1cmk6IFwiaHR0cHM6Ly9ncmFwaC5mYWNlYm9vay5jb20vdjIuNi9tZS9tZXNzYWdlc1wiLFxuICAgIHFzOiB7IGFjY2Vzc190b2tlbjogUEFHRV9BQ0NFU1NfVE9LRU4gfSxcbiAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgIGpzb246IHJlcXVlc3RfYm9keVxuICB9LCAoZXJyLCByZXMsIGJvZHkpID0+IHtcbiAgICBpZiAoIWVycikge1xuICAgICAgaWYgKHZlcmJvc2UpIGNvbnNvbGUubG9nKCdtZXNzYWdlIHNlbnQhJylcbiAgICB9IGVsc2Uge1xuICAgICAgY29uc29sZS5lcnJvcihcIlVuYWJsZSB0byBzZW5kIG1lc3NhZ2U6XCIgKyBlcnIpO1xuICAgIH1cbiAgfSk7XG4gIFxuICAvLyBzYXZlIGxhc3QgbWVzc2FnZVxuICBpZiAocmVzcG9uc2UudGV4dCAhPSByZXBlYXRUZXh0KSB7XG4gICAgdXNlcnNbc2VuZGVyX3BzaWRdLmxhc3RfbWVzc2FnZSA9IHtcbiAgICAgIHNlbmRlcl9wc2lkOiBzZW5kZXJfcHNpZCxcbiAgICAgIHJlc3BvbnNlOiByZXNwb25zZSxcbiAgICAgIGZpbGVfZGF0YTogZmlsZV9kYXRhXG4gICAgfTtcbiAgfVxuICBcbiAgd3JpdGVVc2VycygpO1xufVxuXG5mdW5jdGlvbiByZXBlYXRMYXN0bWVzc2FnZShzZW5kZXJfcHNpZCkge1xuICBcbiAgaWYgKHNlbmRlcl9wc2lkID09IHVuZGVmaW5lZCB8fCBcbiAgICAgIHVzZXJzW3NlbmRlcl9wc2lkXSAhPSB1bmRlZmluZWQpIHtcbiAgICBcbiAgICBjb25zdCBtZXNzYWdlID0gdXNlcnNbc2VuZGVyX3BzaWRdLmxhc3RfbWVzc2FnZTtcbiAgICBcbiAgICAvLyBDb25zdHJ1Y3QgdGhlIG1lc3NhZ2UgYm9keVxuICAgIGxldCByZXF1ZXN0X2JvZHkgPSB7XG4gICAgICByZWNpcGllbnQ6IHtcbiAgICAgICAgaWQ6IHNlbmRlcl9wc2lkXG4gICAgICB9LFxuICAgICAgbWVzc2FnZTogeyB0ZXh0OiByZXBlYXRUZXh0IH1cbiAgICB9XG5cbiAgICAvLyBTZW5kIHRoZSBIVFRQIHJlcXVlc3QgdG8gdGhlIE1lc3NlbmdlciBQbGF0Zm9ybVxuICAgIHJlcXVlc3Qoe1xuICAgICAgdXJpOiBcImh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YyLjYvbWUvbWVzc2FnZXNcIixcbiAgICAgIHFzOiB7IGFjY2Vzc190b2tlbjogUEFHRV9BQ0NFU1NfVE9LRU4gfSxcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBqc29uOiByZXF1ZXN0X2JvZHlcbiAgICB9LCAoZXJyLCByZXMsIGJvZHkpID0+IHtcbiAgICAgIGlmICghZXJyKSB7XG4gICAgICAgIGlmICh2ZXJib3NlKSBjb25zb2xlLmxvZygnbWVzc2FnZSBzZW50IScpXG4gICAgICAgIFxuICAgICAgICBjYWxsU2VuZEFQSShzZW5kZXJfcHNpZCwgbWVzc2FnZS5yZXNwb25zZSwgbWVzc2FnZS5maWxlX2RhdGEpO1xuICAgICAgICBcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoXCJVbmFibGUgdG8gc2VuZCBtZXNzYWdlOlwiICsgZXJyKTtcbiAgICAgIH1cbiAgICB9KTtcblxuXG4gIH0gZWxzZSB7XG4gICAgdXNlcnNbc2VuZGVyX3BzaWRdID0ge307XG4gICAgZ2V0Rmlyc3RNZXNzYWdlKHNlbmRlcl9wc2lkKS50aGVuKHQgPT4ge1xuICAgICAgY29uc3QgcmVzcG9uc2UgPSBnZXRZZXNOb1F1aWNrUXVlc3Rpb24odCk7XG4gICAgICBjYWxsU2VuZEFQSShzZW5kZXJfcHNpZCwgcmVzcG9uc2UpO1xuICAgIH0pO1xuICB9XG59XG5cbmZ1bmN0aW9uIGdldFllc05vUXVpY2tRdWVzdGlvbihxdWVzdGlvbikge1xuICBcbiAgY29uc3QgcmVwbGllcyA9IFtcbiAgICB7XG4gICAgICBjb250ZW50X3R5cGU6IFwidGV4dFwiLFxuICAgICAgdGl0bGU6IFwiWWVzXCIsXG4gICAgICBwYXlsb2FkOiBcIllFU19QQVlMT0FEXCJcbiAgICB9LFxuICAgIHtcbiAgICAgIGNvbnRlbnRfdHlwZTogXCJ0ZXh0XCIsXG4gICAgICB0aXRsZTogXCJOb1wiLFxuICAgICAgcGF5bG9hZDogXCJOT19QQVlMT0FEXCJcbiAgICB9XG4gIF07XG4gIHJldHVybiBnZXRRdWlja1F1ZXN0aW9uKHF1ZXN0aW9uLCByZXBsaWVzKTtcbn1cbiAgXG5cbmZ1bmN0aW9uIGdldFF1aWNrUXVlc3Rpb24ocXVlc3Rpb24sIHJlcGxpZXMpIHtcbiAgcmV0dXJuIHsgdGV4dDogcXVlc3Rpb24sIHF1aWNrX3JlcGxpZXM6IHJlcGxpZXMgfTtcbn1cblxuXG5mdW5jdGlvbiBjb250YWN0KCkge1xuICBsZXQgYm9keSA9ICdUaGFua3MgZm9yIHdhbnRpbmcgdG8gZ2V0IGluIHRvdWNoISBZb3UgY2FuIGVtYWlsIG1lIGF0IGxlb25mZWRkZW5AZ21haWwuY29tXFxuXFxuSSB3aWxsIG5vdyByZXBlYXQgbXkgbGFzdCBtZXNzYWdlIDopJztcbiAgcmV0dXJuIGJvZHk7XG59XG5cblxuYXN5bmMgZnVuY3Rpb24gZ2V0Rmlyc3RNZXNzYWdlKHBzaWQpIHtcbiAgbGV0IHRleHQgPSAnSGV5ISBHcmVhdCB0byBoZWFyIGZyb20geW91LlxcblxcbkkgYW0gZ29pbmcgdG8gYXNrIHlvdSBhIGZldyBxdWVzdGlvbnMgYW5kIHRoZW4gZW1haWwgYSBsZXR0ZXIgdG8geW91IHRoYXQgY2FuIGJlIHVzZWQgdG8gaGVscCByZWNvdmVyIHNvbWUgb2YgeW91ciB0dWl0aW9uIGZlZXMuJztcbiAgdmFyIGJvZHkgPSBhd2FpdCBmaXJzdE1lc3NhZ2UocHNpZCk7XG4gIGxldCBvYmplY3QgPSBKU09OLnBhcnNlKGJvZHkpO1xuICBsZXQgZmlyc3ROYW1lID0gb2JqZWN0W1wiZmlyc3RfbmFtZVwiXTtcbiAgbGV0IGxhc3ROYW1lID0gb2JqZWN0W1wibGFzdF9uYW1lXCJdO1xuICBcbiAgaWYgKGZpcnN0TmFtZSA9PSB1bmRlZmluZWQgfHwgbGFzdE5hbWUgPT0gdW5kZWZpbmVkKSB7XG4gICAgXG4gICAgdXNlcnNbcHNpZF0uc3RhdGUgPSBzdGF0ZXMuYXNrX25hbWU7XG4gICAgdGV4dCArPSAnXFxuXFxuRm9yIHNvbWUgcmVhc29uIEkgY2FuIG5vdCBhY2Nlc3MgeW91ciBuYW1lLiBXaGF0IGlzIHlvdXIgZnVsbCBuYW1lPyc7XG4gIH0gZWxzZSB7XG4gICAgXG4gICAgdXNlcnNbcHNpZF0uc3RhdGUgPSBzdGF0ZXMuY29uZmlybV9uYW1lO1xuICAgIHRleHQgKz0gXCJcXG5cXG5JIGhhdmUgeW91ciBuYW1lIGFzIFwiO1xuICAgIHRleHQgKz0gKGZpcnN0TmFtZSArIFwiIFwiICsgbGFzdE5hbWUpO1xuICAgIHRleHQgKz0gXCIsIGlzIHRoYXQgcmlnaHQ/XCI7XG4gICAgdXNlcnNbcHNpZF0uZmlyc3RfbmFtZSA9IGZpcnN0TmFtZTtcbiAgICB1c2Vyc1twc2lkXS5sYXN0X25hbWUgPSBsYXN0TmFtZTtcbiAgfVxuICByZXR1cm4gdGV4dDtcbn1cblxuZnVuY3Rpb24gZmlyc3RNZXNzYWdlKHBzaWQpIHtcblxuICBsZXQgdXJpID0gYGh0dHBzOi8vZ3JhcGguZmFjZWJvb2suY29tL3YyLjYvJHtwc2lkfWBcbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUpIHtcblxuICAgIHJlcXVlc3Qoe1xuICAgICAgdXJpOiB1cmksXG4gICAgICBxczogeyBcbiAgICAgICAgYWNjZXNzX3Rva2VuOiBQQUdFX0FDQ0VTU19UT0tFTixcbiAgICAgICAgZmllbGRzOiBcImZpcnN0X25hbWUsbGFzdF9uYW1lXCJcbiAgICAgIH0sXG4gICAgICBtZXRob2Q6IFwiR0VUXCJcbiAgICB9LCAoZXJyb3IsIHJlcywgYm9keSkgPT4ge1xuICAgICAgaWYgKCFlcnJvcikge1xuICAgICAgICBcbiAgICAgICAgcmVzb2x2ZShib2R5KTtcblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc29sZS5lcnJvcihcIlVuYWJsZSB0byBzZW5kIG1lc3NhZ2U6XCIgKyBlcnJvcik7XG4gICAgICAgIHJlc29sdmUodW5kZWZpbmVkKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfSk7XG59XG4iXX0=",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "app.js"
      ],
      "names": [
        "psid",
        "text",
        "firstMessage",
        "body",
        "object",
        "JSON",
        "parse",
        "firstName",
        "lastName",
        "undefined",
        "users",
        "state",
        "states",
        "ask_name",
        "confirm_name",
        "first_name",
        "last_name",
        "getFirstMessage",
        "Object",
        "freeze",
        "greeting",
        "confirm_goldsmiths_student",
        "warning_non_goldsmiths_student",
        "confirm_student_id",
        "ask_how_many_days",
        "ask_how_much_cost",
        "create_signiture",
        "ask_data_format",
        "send",
        "ask_first_name",
        "ask_last_name",
        "ask_email",
        "repeatText",
        "String",
        "prototype",
        "levenstein",
        "string",
        "a",
        "b",
        "m",
        "i",
        "j",
        "min",
        "Math",
        "length",
        "charAt",
        "verbose",
        "sigFolder",
        "publicURL",
        "request",
        "require",
        "express",
        "goldsmiths",
        "body_parser",
        "app",
        "use",
        "json",
        "fs",
        "sh",
        "nodemailer",
        "validator",
        "transporter",
        "createTransport",
        "service",
        "auth",
        "user",
        "process",
        "env",
        "GMAIL_ADDRESS",
        "pass",
        "GMAIL_PASSWORD",
        "readUsers",
        "e",
        "PAGE_ACCESS_TOKEN",
        "listen",
        "PORT",
        "console",
        "log",
        "static",
        "ALLOWED_BY",
        "Set",
        "get",
        "req",
        "res",
        "domain",
        "query",
        "has",
        "setHeader",
        "sendFile",
        "post",
        "entry",
        "forEach",
        "webhook_event",
        "messaging",
        "sender_psid",
        "sender",
        "id",
        "toString",
        "message",
        "invalidStates",
        "validState",
        "toLowerCase",
        "then",
        "response",
        "getYesNoQuickQuestion",
        "t",
        "callSendAPI",
        "handleMessage",
        "error",
        "postback",
        "handlePostback",
        "status",
        "sendStatus",
        "VERIFY_TOKEN",
        "mode",
        "token",
        "challenge",
        "respond",
        "on",
        "data",
        "name",
        "stop",
        "isNaN",
        "parseInt",
        "substring",
        "filePath",
        "__dirname",
        "notifyUserRecivedSignature",
        "replace",
        "buf",
        "Buffer",
        "writeFile",
        "err",
        "signature_exists",
        "end",
        "quick_replies",
        "content_type",
        "title",
        "payload",
        "handleTextMessage",
        "received_message",
        "userState",
        "quickReplies",
        "student_id",
        "tuition_fee",
        "Number",
        "days",
        "amount_days",
        "cost",
        "moneyOwed",
        "amount_reimburse",
        "email_address",
        "validate",
        "handleQuickReply",
        "received_reply",
        "university",
        "attachment",
        "type",
        "template_type",
        "buttons",
        "url",
        "webview_height_ratio",
        "messenger_extensions",
        "replies",
        "getQuickQuestion",
        "tuitionFee",
        "isGoldsmiths",
        "latexString",
        "generateLatexFile",
        "shell",
        "exec",
        "silent",
        "stdout",
        "stderr",
        "code",
        "mailOptions",
        "from",
        "to",
        "subject",
        "html",
        "attachments",
        "filename",
        "path",
        "sendMail",
        "info",
        "unlink",
        "tuition_cost",
        "fractionDays",
        "fractionCost",
        "floor",
        "quick_reply",
        "isSig",
        "repeatLastmessage",
        "received_postback",
        "last_message",
        "request_body",
        "recipient",
        "contact",
        "uri",
        "qs",
        "access_token",
        "method",
        "file_data",
        "writeUsers",
        "stringify",
        "readFile",
        "fileContent",
        "filedata",
        "question",
        "Promise",
        "resolve",
        "fields"
      ],
      "mappings": "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",
      "file": "app.js",
      "sourceRoot": "/app",
      "sourcesContent": [
        "/*\n * Starter Project for Messenger Platform Quick Start Tutorial\n *\n * Remix this as the starting point for following the Messenger Platform\n * quick start tutorial.\n *\n * https://developers.facebook.com/docs/messenger-platform/getting-started/quick-start/\n *\n */\n\n\n\nvar states = Object.freeze({\n  greeting: 0,\n  ask_name: 1,\n  confirm_name: 2,\n  confirm_goldsmiths_student: 3,\n  warning_non_goldsmiths_student: 4,\n  confirm_student_id: 5,\n  ask_how_many_days: 6,\n  ask_how_much_cost: 7,\n  create_signiture: 8,\n  ask_data_format: 9,\n  send: 10,\n  ask_first_name: 11,\n  ask_last_name: 12,\n  ask_email: 13\n});\n\nconst repeatText = \"Sorry I didn't understand your reply :( I'll repeat my last message to you!\";\n\nString.prototype.levenstein = function(string) {\n    var a = this, b = string + \"\", m = [], i, j, min = Math.min;\n\n    if (!(a && b)) return (b || a).length;\n\n    for (i = 0; i <= b.length; m[i] = [i++]);\n    for (j = 0; j <= a.length; m[0][j] = j++);\n\n    for (i = 1; i <= b.length; i++) {\n        for (j = 1; j <= a.length; j++) {\n            m[i][j] = b.charAt(i - 1) == a.charAt(j - 1)\n                ? m[i - 1][j - 1]\n                : m[i][j] = min(\n                    m[i - 1][j - 1] + 1, \n                    min(m[i][j - 1] + 1, m[i - 1 ][j] + 1))\n        }\n    }\n\n    return m[b.length][a.length];\n}\n\nconst verbose = false;\nconst sigFolder = 'public';\nconst publicURL = 'https://grateful-duckling.glitch.me';\n\n'use strict';\n\n// Imports dependencies and set up http server\n\nconst \n  request = require('request'),\n  express = require('express'),\n  goldsmiths = require('./goldsmiths'),\n  body_parser = require('body-parser'),\n  app = express().use(body_parser.json()); // creates express http server\nconst fs = require('fs');\nvar sh = require('shelljs');\nvar nodemailer = require('nodemailer');\nvar validator = require(\"email-validator\");\n\nvar transporter = nodemailer.createTransport({\n service: 'gmail',\n auth: {\n        user: process.env.GMAIL_ADDRESS,\n        pass: process.env.GMAIL_PASSWORD\n    }\n});\n\nvar users;\ntry {\n  readUsers();\n} catch (e) {\n  users = {};\n}\n\nconst PAGE_ACCESS_TOKEN = process.env.PAGE_ACCESS_TOKEN;\n\n// Sets server port and logs message on success\napp.listen(process.env.PORT || 1337, () => console.log('webhook is listening'));\n\napp.use(express.static('public'));\n\n// Define the URLs we'll allow.\nvar ALLOWED_BY = new Set([\n  'https://www.messenger.com/',\n  'https://www.facebook.com/'\n])\n\napp.get('/iframe', function (req, res) {\n  // Is the URL in the whitelist?\n  // Set X-Frame-Options if so. Otherwise, we won't\n  // set the header and browsers will block it.\n  var domain = String(req.query.domain)\n  if (ALLOWED_BY.has(domain)) {\n    res.setHeader('X-Frame-Options', 'ALLOW-FROM ' + domain)\n  }\n\n  // Send the iframe as usual.\n  res.sendFile('iframe.html')\n})\n\n// Accepts POST requests at /webhook endpoint\napp.post('/webhook', (req, res) => {  \n\n  // Parse the request body from the POST\n  let body = req.body;\n\n  // Check the webhook event is from a Page subscription\n  if (body.object === 'page') {\n\n    // Iterate over each entry - there may be multiple if batched\n    body.entry.forEach(function(entry) {\n\n      // Get the webhook event. entry.messaging is an array, but \n      // will only ever contain one event, so we get index 0\n      let webhook_event = entry.messaging[0];\n      \n      if (verbose) console.log(webhook_event);\n      \n      // Get the sender PSID\n      let sender_psid = webhook_event.sender.id.toString();\n      if (verbose) console.log('Sender PSID: ' + sender_psid);\n      // Check if the event is a message or a postback\n      // Pass the event to the appropraite handler function.\n      \n      \n      const message = webhook_event.message;\n      \n      const invalidStates = [\n        states.confirm_student_id,\n        states.ask_how_many_days,\n        states.ask_how_much_cost,\n        states.ask_first_name,\n        states.ask_last_name,\n        states.ask_email\n      ];\n      \n      let validState = true;\n      if (users[sender_psid] != undefined) {\n        for (var i = 0; i < invalidStates.length; ++i) {\n          if (users[sender_psid].state == invalidStates[i]) {\n            validState = false;\n            i = invalidStates.length;\n            break;\n          }\n        } \n      }\n      \n      if (message) {\n        \n        try {\n          if (validState && (\n              message.text.toLowerCase().levenstein('start again') < 2 ||\n              message.text.toLowerCase().levenstein('start') < 2 ||\n              message.text.toLowerCase().levenstein('hello') < 2 ||\n              message.text.toLowerCase().levenstein('hi') < 2 ||\n              message.text.toLowerCase().levenstein('hello there') < 2 ||\n              message.text.toLowerCase().levenstein('hi there') < 2 ||\n              message.text.toLowerCase().levenstein('begin') < 2)) {\n\n            // Set the response based on the postback payload\n            users[sender_psid] = {};\n            getFirstMessage(sender_psid).then(t => {\n\n              const response = getYesNoQuickQuestion(t);\n\n              callSendAPI(sender_psid, response);\n            });\n\n          } else {\n\n            handleMessage(sender_psid, message);\n          }\n        \n        } catch (error) {\n          \n          console.log(error);\n        }\n        \n      } else if (webhook_event.postback) {\n        handlePostback(sender_psid, webhook_event.postback);\n      }\n    });\n\n    // Return a '200 OK' response to all events\n    res.status(200).send('EVENT_RECEIVED');\n\n  } else {\n    // Return a '404 Not Found' if event is not from a page subscription\n    res.sendStatus(404);\n  }\n\n});\n\n// Accepts GET requests at the /webhook endpoint\napp.get('/webhook', (req, res) => {\n  \n  /** UPDATE YOUR VERIFY TOKEN **/\n  const VERIFY_TOKEN = \"superdude\";\n  \n  // Parse params from the webhook verification request\n  let mode = req.query['hub.mode'];\n  let token = req.query['hub.verify_token'];\n  let challenge = req.query['hub.challenge'];\n    \n  // Check if a token and mode were sent\n  if (mode && token) {\n  \n    // Check the mode and token sent are correct\n    if (mode === 'subscribe' && token === VERIFY_TOKEN) {\n      \n      // Respond with 200 OK and challenge token from the request\n      console.log('WEBHOOK_VERIFIED');\n      res.status(200).send(challenge);\n    \n    } else {\n      // Responds with '403 Forbidden' if verify tokens do not match\n      res.sendStatus(403);      \n    }\n  }\n});\n\n\n// Handle POST from xxx/receive\napp.post('/receive', function(request, respond) {\n  \n  let body = '';\n  \n  request.on('data', function(data) {\n    body += data;\n  });\n  \n  request.on('end', function (){\n    \n    body = JSON.parse(body);\n    \n    let psid = body.name;\n    \n    if (psid.length > 25) {\n\n      let stop;\n      for (var i = 0; i < psid.length; ++i) {\n\n        stop = i;\n        if (isNaN(parseInt(psid[i], 10))) {\n          break;\n        }\n      }\n\n      psid = psid.substring(0, stop);\n    }\n    \n    const filePath = __dirname + '/' + sigFolder + '/' + `${psid}.png`;\n    \n    notifyUserRecivedSignature(psid);\n    \n    // Get rid of the image header as we only need the data parts after it.\n    const data = body.data.replace(/^data:image\\/\\w+;base64,/, \"\");\n    // Create a buffer and set its encoding to base64\n    var buf = new Buffer(data, 'base64');\n    // Write\n    fs.writeFile(filePath, buf, function(err){\n      if (err) throw err\n      // Respond to client that the canvas image is saved.\n      \n      users[psid].signature_exists = true;\n      respond.end();\n    });\n  });\n});\n\nfunction notifyUserRecivedSignature(psid) {\n\n  users[psid].state = states.ask_data_format;\n  const response = {\n    \n    text: 'Great, we got your signature! For now I will only support rendering your letter as a PDF - but more features are coming soon! Please select PDF below to continue :)',\n      \n    quick_replies: [\n      {\n        content_type: \"text\",\n        title: \"PDF\",\n        payload: \"LATEX_PAYLOAD\"\n      }\n    ],\n    \n  };\n  \n  callSendAPI(psid, response);\n}\n\n\n\n\n\n\n\n\n\n\nfunction handleTextMessage(sender_psid, received_message) {\n  \n  let userState = users[sender_psid].state;\n  let text;\n  let quickReplies = null;\n  \n  if (userState == states.ask_name) {\n\n    text = \"Thanks \" + received_message;\n    \n  } else if (userState == states.ask_first_name) {\n    \n    text = \"Thanks \" + received_message + \". Now what is your second name?\";\n    users[sender_psid].first_name = received_message;\n    users[sender_psid].state = states.ask_last_name;\n    \n  } else if (userState == states.ask_last_name) {\n    \n    text = \"Awesome! Now are you a goldsmiths student?\";\n    users[sender_psid].last_name = received_message;\n    \n    quickReplies = [\n      {\n        content_type: \"text\",\n        title: \"Yes\",\n        payload: \"YES_PAYLOAD\"\n      },\n      {\n        content_type: \"text\",\n        title: \"No\",\n        payload: \"NO_PAYLOAD\"\n      }\n    ]\n    users[sender_psid].state = states.confirm_goldsmiths_student;\n\n  } else if (userState == states.confirm_student_id) {\n    \n    users[sender_psid].student_id = received_message;\n    \n    users[sender_psid].state = states.ask_email;\n    \n    text = `Thanks. Next I need to know your email address, prefereably your student one so there is an easy contact method in the correspodance I generate for you. To be clear, I will not store, share or ever send you anything via this email address.\\n\\nPlease write your email adress down next.`;\n    \n  } else if (userState == states.ask_how_much_cost) {\n    \n    users[sender_psid].tuition_fee = Number(received_message);\n    \n    if (!isNaN(users[sender_psid].tuition_fee)) {\n      \n      const days = users[sender_psid].amount_days;\n\n      const cost = moneyOwed(users[sender_psid].tuition_fee, days);\n      users[sender_psid].amount_reimburse = cost;\n\n      text = `Thanks again! Nearly done now :)\\n\\n` +\n             `I calculate that 14 out of your ${days} days at your tuition cost means you should be reinbursed £${cost}.\\n\\n` + \n             `Would you like to add your signature to the correspondance? ` +\n             `(A pop-up will appear)`;\n      quickReplies = [ \n        {\n          content_type: \"text\",\n          title: \"Sounds cool!\",\n          payload: \"YES_PAYLOAD\"\n        },\n        {\n          content_type: \"text\",\n          title: \"No Thanks\",\n          payload: \"NO_PAYLOAD\"\n        }\n      ];\n\n      users[sender_psid].state = states.create_signiture;\n    }\n\n  } else if (userState == states.ask_how_many_days) {\n    \n    users[sender_psid].amount_days = Number(received_message);\n    \n    if (!isNaN(users[sender_psid].amount_days)) {\n      \n      users[sender_psid].state = states.ask_how_much_cost;\n\n      text = \"Great thanks for that.\\n\\n\" +\n             \"Next, how much is the tution fees for this academic year?\\n\\n\" + \n             \"Select either a custom amount (in GBP £) or the default, £9000.\";\n      quickReplies = [\n        {\n          content_type: \"text\",\n          title: \"Default £9000\",\n          payload: \"DEFAULT_PAYLOAD\"\n        },\n        {\n          content_type: \"text\",\n          title: \"Custom\",\n          payload: \"CUSTOM_PAYLOAD\"\n        }\n      ];\n    }\n  } else if (userState == states.ask_email) {\n    \n    users[sender_psid].email_address = received_message;\n    \n    if (validator.validate(users[sender_psid].email_address)) {\n      \n      users[sender_psid].state = states.ask_how_many_days;\n\n      text = `We will now need to work out how much you are owed.\\n\\n` +\n             `For now, we will work out the ` +\n             `fraction of tution fee that you have spent not accessing the ` +\n             `universities facilities during the 14 day strike. Firstly, we ` +\n             `need to know how many days there are in your academic year. On ` +\n             `average (and this is a conservative estimate) there are 170.\\n\\n` +\n             `Would you like to use the default 170 days or would you like to ` +\n             `enter a custom amount?`;\n\n      quickReplies = [\n        {\n          content_type: \"text\",\n          title: \"Default\",\n          payload: \"DEFAULT_PAYLOAD\"\n        },\n        {\n          content_type: \"text\",\n          title: \"Custom\",\n          payload: \"CUSTOM_PAYLOAD\"\n        }\n      ];\n    }\n  }\n  \n  let response = { text: text };\n  \n  if (quickReplies != null) {\n    response.quick_replies = quickReplies;\n  }\n  \n  return response;\n}\n\n\nfunction handleQuickReply(sender_psid, received_reply) {\n  \n  let payload = received_reply.payload;\n  let response;\n  \n  if (payload === 'YES_PAYLOAD') {\n       \n    if (users[sender_psid].state == states.confirm_name) {\n      \n      response = getYesNoQuickQuestion(\"Great, thanks! Now, are you a Goldsmiths student?\");\n      \n      users[sender_psid].state = states.confirm_goldsmiths_student;\n\n    } else if (users[sender_psid].state == states.confirm_goldsmiths_student) {\n      \n      response = {\n        \"text\": \"Okay great, thanks! Can you next tell me what your student ID number is?\"\n      }\n      \n      users[sender_psid].university = \"goldsmiths\";      \n      users[sender_psid].state = states.confirm_student_id;\n      \n    } else if (users[sender_psid].state == states.create_signiture) {\n      \n      response = {\n        attachment: {\n          type: \"template\",\n          payload: {\n            template_type: \"button\",\n            text: \"Draw your signiture!\",\n            buttons: [\n              {\n                type: \"web_url\",\n                url: `https://grateful-duckling.glitch.me?${sender_psid}`,\n                title: \"Start here\",\n                webview_height_ratio: \"tall\",\n                messenger_extensions: \"true\",  \n              }\n            ]\n          }\n        }\n      };\n    }\n    \n  } else if (payload === 'NO_PAYLOAD') {\n    \n    if (users[sender_psid].state == states.confirm_name) {\n      \n      response = {\n        text: \"Okay no problem! Please tell me your first name.\"\n      }\n      \n      users[sender_psid].state = states.ask_first_name;\n    \n    } else if (users[sender_psid].state == states.confirm_goldsmiths_student) {\n      \n      response = {\n        text: \"Okay no problem! Just be aware that this chatbot and the functionality is in an alpha stage with Goldsmiths students in mind, so there may be a few elements that are not currently available to you. If you have feature requests please leave messages on my facebook page! :)\\n\\nOkay next question - what is your student ID number?\"\n      }\n\n      users[sender_psid].university = \"other\";\n      users[sender_psid].state = states.confirm_student_id;\n    \n    } else if (users[sender_psid].state == states.create_signiture) {\n      \n      users[sender_psid].signature_exists = false;\n      users[sender_psid].state = states.ask_data_format;\n      response = {\n\n        text: 'No problem! For now I will only support rendering your letter as a PDF - but more features are coming soon! Please select PDF below to continue :)',\n\n        quick_replies: [\n          {\n            content_type: \"text\",\n            title: \"PDF\",\n            payload: \"LATEX_PAYLOAD\"\n          }\n        ],\n    \n      };\n      \n    }\n    \n  } else if (payload === 'CUSTOM_PAYLOAD') {\n    \n    if (users[sender_psid].state == states.ask_how_many_days) {\n      response = {\n        text: \"Please write in numbers how many days you have in your academic year.\"\n      }\n    \n    } else if (users[sender_psid].state == states.ask_how_much_cost) {\n      response = {\n        text: \"Please write in numbers how much in british pound sterling £ your annual tuition fee is.\"\n      }\n    \n    }\n    \n  } else if (payload === 'DEFAULT_PAYLOAD') {\n    \n    if (users[sender_psid].state == states.ask_how_many_days) {\n      \n      users[sender_psid].amount_days = 170;\n      \n      let text = \"Great thanks for that.\\n\\n\" +\n                 \"Next, how much is the tution fees for this academic year?\\n\\n\" + \n                 \"Select either a custom amount (in GBP £) or the default, £9000.\";\n      let replies = [\n        {\n          content_type: \"text\",\n          title: \"Default £9000\",\n          payload: \"DEFAULT_PAYLOAD\"\n        },\n        {\n          content_type: \"text\",\n          title: \"Custom\",\n          payload: \"CUSTOM_PAYLOAD\"\n        }\n      ];\n      response = getQuickQuestion(text, replies);\n      users[sender_psid].state = states.ask_how_much_cost;\n      \n    } else if (users[sender_psid].state == states.ask_how_much_cost) {\n    \n      const tuitionFee = 9000;\n      users[sender_psid].tuition_fee = tuitionFee;\n      const days = users[sender_psid].amount_days;\n\n      const cost = moneyOwed(tuitionFee, days);\n      users[sender_psid].amount_reimburse = cost;\n      // I calculate that 14 out of your ${days} days at your tuition cost means you should be \n      let text = `Thanks again! Nearly done now :)\\n\\n` +\n                 `I calculate that 14 out of your ${days} days at your tuition cost means you should be reinbursed £${cost}.\\n\\n` + \n                 `Signatures can help improve the authenticity of documents. Would you like to add your signature to the generated correspondance? `;\n      let replies = [ \n        {\n          content_type: \"text\",\n          title: \"Yes\",\n          payload: \"YES_PAYLOAD\"\n        },\n        {\n          content_type: \"text\",\n          title: \"No\",\n          payload: \"NO_PAYLOAD\"\n        }\n      ];\n      response = getQuickQuestion(text, replies);\n      users[sender_psid].state = states.create_signiture;\n    \n    } \n  } else if (payload === 'LATEX_PAYLOAD') {\n  \n    const isGoldsmiths = users[sender_psid].university == \"goldsmiths\";\n    \n    // Create the latex file from template and user data.\n    const latexString = goldsmiths.generateLatexFile(sender_psid, \n                                                     users[sender_psid].first_name, \n                                                     users[sender_psid].last_name, \n                                                     users[sender_psid].email_address, \n                                                     users[sender_psid].student_id, \n                                                     users[sender_psid].tuition_fee, \n                                                     users[sender_psid].amount_days, \n                                                     users[sender_psid].amount_reimburse,\n                                                     users[sender_psid].signature_exists,\n                                                     isGoldsmiths);\n\n    fs.writeFile(`./public/${sender_psid}.tex`, latexString, function(err) {\n      if (err) {\n        return console.log(err);\n      }\n      \n      let shell;\n      if (users[sender_psid].signature_exists) {\n        shell = `./laton public/${sender_psid}.tex public/${sender_psid}.png && mv ${sender_psid}.pdf public/`;\n      } else {\n        shell = `./laton public/${sender_psid}.tex && mv ${sender_psid}.pdf public/`\n      }\n      \n      // Use laton and wait for pdf to exist.\n      const { stdout, stderr, code } = sh.exec(shell, { silent: true });\n      \n      const mailOptions = {\n        from: process.env.GMAIL_ADDRESS, // sender address\n        to: users[sender_psid].email_address, // list of receivers\n        subject: 'Your tuition fee reclaimation letter', // Subject line\n        html: '<p>Hi! Please find attached your tuition fee letter. Make sure you send it to the right people!</p>',// plain text body\n        attachments: [{\n          filename: \"letter.pdf\",\n          path: `public/${sender_psid}.pdf`\n        }]\n      };\n      // Send as attachment.\n      // Send the HTTP request to the Messenger Platform\n      transporter.sendMail(mailOptions, function (err, info) {\n        if (verbose)\n          console.log(info);\n        \n        // Clean up\n        fs.unlink(`./public/${sender_psid}.pdf`, (err) => {\n          if (verbose)\n            console.log(`./public/${sender_psid}.pdf was deleted`);\n        });\n        fs.unlink(`./public/${sender_psid}.tex`, (err) => {\n          if (verbose)\n            console.log(`./public/${sender_psid}.tex was deleted`);\n        });\n        if (users[sender_psid].signature_exists) {\n          fs.unlink(`./public/${sender_psid}.png`, (err) => {\n            if (verbose)\n              console.log(`./public/${sender_psid}.png was deleted`);\n          });\n        }\n      });\n\n    }); \n    \n    response = {\n        \"text\": \"Awesome! I'm just generating your document and a link will be sent to the email adress you supplied earlier! If you would like to use my service again, please select 'start again' from the menu below :)\"\n    }\n  }\n  return response;\n}\n\nfunction moneyOwed(tuition_cost, amount_days) {\n  \n  const fractionDays = 14 / amount_days;\n  const fractionCost = fractionDays * tuition_cost;\n  return Math.floor(fractionCost);\n}\n\n// Handles messages events\nfunction handleMessage(sender_psid, received_message) {\n  \n  let response;\n\n  // Check if the message is a quick reply.\n  if (received_message.quick_reply) {\n    \n    response = handleQuickReply(sender_psid, received_message.quick_reply);\n    \n  } else  if (received_message.text) {      \n    \n    response = handleTextMessage(sender_psid, received_message.text);   \n  }\n  \n  let isSig = true;\n  \n  try {\n    if (response.attachment.payload.text != 'Draw your signiture!') {\n      isSig = false;\n    }\n  } catch (e) {\n    isSig = false;\n  }\n\n  if (response.text == undefined && !isSig)\n    repeatLastmessage(sender_psid);\n  \n  else\n    // Sends the response message\n    callSendAPI(sender_psid, response);  \n}\n\n// Handles messaging_postbacks events\nfunction handlePostback(sender_psid, received_postback) {\n  \n  let response;\n  \n  // Get the payload for the postback\n  let payload = received_postback.payload;\n\n  // Set the response based on the postback payload\n  if (payload === 'Greeting' || payload == 'START_AGAIN_PAYLOAD') {\n    \n    users[sender_psid] = {};\n    getFirstMessage(sender_psid).then(t => {\n      \n      response = getYesNoQuickQuestion(t);\n      \n      callSendAPI(sender_psid, response);\n    });\n\n  } else if (payload === 'CONTACT_PAYLOAD') {\n    \n    const message = users[sender_psid].last_message;\n    \n    // Construct the message body\n    let request_body = {\n      recipient: {\n        id: sender_psid\n      },\n      message: { text: contact() }\n    }\n\n    // Send the HTTP request to the Messenger Platform\n    request({\n      uri: \"https://graph.facebook.com/v2.6/me/messages\",\n      qs: { access_token: PAGE_ACCESS_TOKEN },\n      method: \"POST\",\n      json: request_body\n    }, (err, res, body) => {\n      if (!err) {\n        if (verbose) console.log('message sent!')\n        \n        callSendAPI(sender_psid, message.response, message.file_data);\n        \n      } else {\n        console.error(\"Unable to send message:\" + err);\n      }\n    });\n  } \n}\n\nfunction writeUsers() {\n  var string = JSON.stringify(users, null, 2);\n  fs.writeFile('db.json', string, 'utf8', (err) => {\n    if (err) console.log(err);\n  });\n}\n\nfunction readUsers() {\n  fs.readFile('db.json', 'utf8', (err, fileContent) => {\n    if (err) {\n      console.log(err);\n    } else {\n      users = JSON.parse(fileContent.toString());\n      if (verbose)\n        console.log(users);\n    }\n  });\n}\n\n\n// Sends response messages via the Send API\nfunction callSendAPI(sender_psid, response, file_data=null) {\n  // Construct the message body\n  let request_body = {\n    recipient: {\n      id: sender_psid\n    },\n    message: response\n  }\n  \n  if (file_data != null) {\n    request_body.filedata = file_data;\n  }\n\n  // Send the HTTP request to the Messenger Platform\n  request({\n    uri: \"https://graph.facebook.com/v2.6/me/messages\",\n    qs: { access_token: PAGE_ACCESS_TOKEN },\n    method: \"POST\",\n    json: request_body\n  }, (err, res, body) => {\n    if (!err) {\n      if (verbose) console.log('message sent!')\n    } else {\n      console.error(\"Unable to send message:\" + err);\n    }\n  });\n  \n  // save last message\n  if (response.text != repeatText) {\n    users[sender_psid].last_message = {\n      sender_psid: sender_psid,\n      response: response,\n      file_data: file_data\n    };\n  }\n  \n  writeUsers();\n}\n\nfunction repeatLastmessage(sender_psid) {\n  \n  if (sender_psid == undefined || \n      users[sender_psid] != undefined) {\n    \n    const message = users[sender_psid].last_message;\n    \n    // Construct the message body\n    let request_body = {\n      recipient: {\n        id: sender_psid\n      },\n      message: { text: repeatText }\n    }\n\n    // Send the HTTP request to the Messenger Platform\n    request({\n      uri: \"https://graph.facebook.com/v2.6/me/messages\",\n      qs: { access_token: PAGE_ACCESS_TOKEN },\n      method: \"POST\",\n      json: request_body\n    }, (err, res, body) => {\n      if (!err) {\n        if (verbose) console.log('message sent!')\n        \n        callSendAPI(sender_psid, message.response, message.file_data);\n        \n      } else {\n        console.error(\"Unable to send message:\" + err);\n      }\n    });\n\n\n  } else {\n    users[sender_psid] = {};\n    getFirstMessage(sender_psid).then(t => {\n      const response = getYesNoQuickQuestion(t);\n      callSendAPI(sender_psid, response);\n    });\n  }\n}\n\nfunction getYesNoQuickQuestion(question) {\n  \n  const replies = [\n    {\n      content_type: \"text\",\n      title: \"Yes\",\n      payload: \"YES_PAYLOAD\"\n    },\n    {\n      content_type: \"text\",\n      title: \"No\",\n      payload: \"NO_PAYLOAD\"\n    }\n  ];\n  return getQuickQuestion(question, replies);\n}\n  \n\nfunction getQuickQuestion(question, replies) {\n  return { text: question, quick_replies: replies };\n}\n\n\nfunction contact() {\n  let body = 'Thanks for wanting to get in touch! You can email me at leonfedden@gmail.com\\n\\nI will now repeat my last message :)';\n  return body;\n}\n\n\nasync function getFirstMessage(psid) {\n  let text = 'Hey! Great to hear from you.\\n\\nI am going to ask you a few questions and then email a letter to you that can be used to help recover some of your tuition fees.';\n  var body = await firstMessage(psid);\n  let object = JSON.parse(body);\n  let firstName = object[\"first_name\"];\n  let lastName = object[\"last_name\"];\n  \n  if (firstName == undefined || lastName == undefined) {\n    \n    users[psid].state = states.ask_name;\n    text += '\\n\\nFor some reason I can not access your name. What is your full name?';\n  } else {\n    \n    users[psid].state = states.confirm_name;\n    text += \"\\n\\nI have your name as \";\n    text += (firstName + \" \" + lastName);\n    text += \", is that right?\";\n    users[psid].first_name = firstName;\n    users[psid].last_name = lastName;\n  }\n  return text;\n}\n\nfunction firstMessage(psid) {\n\n  let uri = `https://graph.facebook.com/v2.6/${psid}`\n  return new Promise(function(resolve) {\n\n    request({\n      uri: uri,\n      qs: { \n        access_token: PAGE_ACCESS_TOKEN,\n        fields: \"first_name,last_name\"\n      },\n      method: \"GET\"\n    }, (error, res, body) => {\n      if (!error) {\n        \n        resolve(body);\n\n      } else {\n        console.error(\"Unable to send message:\" + error);\n        resolve(undefined);\n      }\n    });\n  });\n}\n"
      ]
    },
    "mtime": 1521493451265
  },
  "{\"filename\":\"/app/goldsmiths.js\",\"env\":{},\"retainLines\":false,\"highlightCode\":true,\"suppressDeprecationMessages\":false,\"presets\":[],\"plugins\":[[[],null],[[],null],[[],null],[[],{\"loose\":false,\"spec\":false}],[[],null],[[],null],[[],{\"spec\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"loose\":false}],[[],null],[[],null],[[],null],[[],{\"loose\":false}],[[],null],[[],{\"loose\":false}],[[],null],[[],null],[[],{\"loose\":false}],[[],{\"async\":false,\"asyncGenerators\":false}]],\"ignore\":[],\"code\":true,\"metadata\":true,\"ast\":true,\"comments\":true,\"compact\":\"auto\",\"minified\":false,\"sourceRoot\":\"/app\",\"babelrc\":true,\"sourceType\":\"module\",\"moduleIds\":false,\"passPerPreset\":false,\"parserOpts\":false,\"generatorOpts\":false}:6.26.0": {
    "metadata": {
      "usedHelpers": [],
      "marked": [],
      "modules": {
        "imports": [],
        "exports": {
          "exported": [],
          "specifiers": []
        }
      }
    },
    "options": {
      "filename": "/app/goldsmiths.js",
      "filenameRelative": "/app/goldsmiths.js",
      "env": {},
      "retainLines": false,
      "highlightCode": true,
      "suppressDeprecationMessages": false,
      "presets": [],
      "plugins": [
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false,
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "spec": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          null
        ],
        [
          [],
          null
        ],
        [
          [],
          {
            "loose": false
          }
        ],
        [
          [],
          {
            "async": false,
            "asyncGenerators": false
          }
        ]
      ],
      "ignore": [],
      "code": true,
      "metadata": true,
      "ast": false,
      "comments": true,
      "compact": "auto",
      "minified": false,
      "sourceMaps": "both",
      "sourceMapTarget": "goldsmiths.js",
      "sourceFileName": "goldsmiths.js",
      "sourceRoot": "/app",
      "babelrc": false,
      "sourceType": "module",
      "moduleRoot": "/app",
      "moduleIds": false,
      "passPerPreset": false,
      "parserOpts": false,
      "generatorOpts": false,
      "basename": "goldsmiths"
    },
    "ignored": false,
    "code": "'use strict';\n\nmodule.exports = {\n\n  generateLatexFile: function generateLatexFile(psid, first_name, last_name, student_email, student_number, tuition_fee, amount_days, amount_reimburse) {\n    var include_signature = arguments.length > 8 && arguments[8] !== undefined ? arguments[8] : true;\n    var is_goldsmiths = arguments.length > 9 && arguments[9] !== undefined ? arguments[9] : true;\n\n\n    var uni = void 0;\n    if (is_goldsmiths) {\n      uni = 'Goldsmiths University of London';\n    } else {\n      uni = 'your university';\n    }\n\n    var latex = '\\\\documentclass{letter}\\n\\\\usepackage{hyperref}\\n\\\\usepackage{graphicx}\\n\\\\usepackage{mathtools}\\n';\n\n    latex += '\\n\\\\DeclarePairedDelimiter\\\\floor{\\\\lfloor}{\\\\rfloor}\\n\\n\\\\signature{' + first_name + ' ' + last_name + '}\\n\\n';\n\n    if (is_goldsmiths) {\n      latex += '\\\\address{Warden\\u2019s Office \\\\\\\\ Ms Helen Keogh \\\\\\\\ Mr Patrick Loughrey \\\\\\\\ \\nDeptford Town Hall Building \\\\\\\\ Room 101 \\\\\\\\ New Cross \\\\\\\\ London, UK \\\\\\\\ \\nSE14 6NW \\\\\\\\ 020 7919 7901}\\n\\n';\n    }\n\n    latex += '\\\\longindentation=0pt\\n\\\\begin{document}\\n\\n\\\\begin{letter}{Student Number: ' + student_number + ' \\\\\\\\ Email: ' + student_email + '}\\n\\\\opening{To the Warden\\'s Office}\\n\\nThis letter is to request reasonable compensation for the loss of lectures and contact time with tutors as a result of the UCU strike action from February 22nd to March 16th.\\n\\nI, as a student of ' + uni + ', demand that the institution refund a portion of my tuition, respective to my enrollment status and programme.\\n\\nDue to the employer\\u2019s failure to protect the livelihoods of its staff, the UCU has organized a fourteen day strike, as a means of opposing the recent proposals that would damage the USS pension scheme. Consequently, the student body suffers a loss of critical mentorship and face time with the faculty, most notably in the loss of organized class time such as lectures, tutorials, workshops, and critiques.\\n\\nConsidering that for the duration of the strike students will not be accessing tuition or crossing the picket line to use Goldsmiths\\u2019 facilities, I believe I should be refunded the following amount: \\\\textbf{\\\\textsterling ' + amount_reimburse + '}\\n\\nThis amount was derived from the fraction of the days missed due to the strikes, $x$, out of the amount of days in the academic year, $y$, multiplied by the tution fees for this year $z$, which is then floored (rounded down) to the nearest pound sterling.\\n\\n\\\\begin{equation}\\n\\\\floor*{\\\\frac{x}{y}z} = \\\\text{\\\\textsterling} \\\\floor*{\\\\frac{14}{' + amount_days + '} \\\\times ' + tuition_fee + '} = \\\\text{\\\\textsterling} ' + amount_reimburse + '\\n\\\\end{equation}\\n\\nIt is the responsibility of the institution to provide a complete and quality education to each of its students, to the fullest extent and duration that it was advertised. Additionally, I find the institution\\u2019s administration to be directly accountable for both the inception and the entire duration of the strike. At any point, the university administration can commit to meaningful negotiation that would fairly address the staff concerns and end the strike. As a result of the rising cost of university tuition, students are burdened by increasing levels of debt. It is irresponsible and unmerited for the university to demand each of its students increase their personal debt for a service that has been denied to them.\\n\\n\\\\vspace{3em}\\n\\nSincerely,\\n\\n';\n\n    if (include_signature) {\n      latex += '\\n\\\\includegraphics[height=12em]{' + psid + '.png}';\n    }\n\n    latex += '\\n\\n' + first_name + ' ' + last_name + '\\n\\n\\\\end{letter}\\n\\\\end{document}';\n\n    return latex;\n  }\n};\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImdvbGRzbWl0aHMuanMiXSwibmFtZXMiOlsibW9kdWxlIiwiZXhwb3J0cyIsImdlbmVyYXRlTGF0ZXhGaWxlIiwicHNpZCIsImZpcnN0X25hbWUiLCJsYXN0X25hbWUiLCJzdHVkZW50X2VtYWlsIiwic3R1ZGVudF9udW1iZXIiLCJ0dWl0aW9uX2ZlZSIsImFtb3VudF9kYXlzIiwiYW1vdW50X3JlaW1idXJzZSIsImluY2x1ZGVfc2lnbmF0dXJlIiwiaXNfZ29sZHNtaXRocyIsInVuaSIsImxhdGV4Il0sIm1hcHBpbmdzIjoiOztBQUFBQSxPQUFPQyxPQUFQLEdBQWlCOztBQUVmQyxxQkFBbUIsMkJBQVNDLElBQVQsRUFBZUMsVUFBZixFQUEyQkMsU0FBM0IsRUFBc0NDLGFBQXRDLEVBQXFEQyxjQUFyRCxFQUFxRUMsV0FBckUsRUFBa0ZDLFdBQWxGLEVBQStGQyxnQkFBL0YsRUFBNko7QUFBQSxRQUE1Q0MsaUJBQTRDLHVFQUExQixJQUEwQjtBQUFBLFFBQXBCQyxhQUFvQix1RUFBTixJQUFNOzs7QUFFOUssUUFBSUMsWUFBSjtBQUNBLFFBQUlELGFBQUosRUFBbUI7QUFDakJDLFlBQU0saUNBQU47QUFDRCxLQUZELE1BRU87QUFDTEEsWUFBTSxpQkFBTjtBQUNEOztBQUVELFFBQUlDLFFBQVEsb0dBQVo7O0FBRUFBLHVGQUlVVixVQUpWLFNBSXdCQyxTQUp4Qjs7QUFRQSxRQUFJTyxhQUFKLEVBQW1CO0FBQ2pCRTtBQUtEOztBQUVMQSw4RkFHa0NQLGNBSGxDLHFCQUdnRUQsYUFIaEUsc1BBUXFCTyxHQVJyQiw4dkJBWWlPSCxnQkFaak8sd1dBaUJ1RUQsV0FqQnZFLGtCQWlCK0ZELFdBakIvRixtQ0FpQndJRSxnQkFqQnhJOztBQTRCQSxRQUFJQyxpQkFBSixFQUF1QjtBQUNyQkcscURBQytCWCxJQUQvQjtBQUVEOztBQUVHVyxzQkFFRlYsVUFGRSxTQUVZQyxTQUZaOztBQU9BLFdBQU9TLEtBQVA7QUFDRDtBQXRFYyxDQUFqQiIsImZpbGUiOiJnb2xkc21pdGhzLmpzIiwic291cmNlUm9vdCI6Ii9hcHAiLCJzb3VyY2VzQ29udGVudCI6WyJtb2R1bGUuZXhwb3J0cyA9IHtcbiAgXG4gIGdlbmVyYXRlTGF0ZXhGaWxlOiBmdW5jdGlvbihwc2lkLCBmaXJzdF9uYW1lLCBsYXN0X25hbWUsIHN0dWRlbnRfZW1haWwsIHN0dWRlbnRfbnVtYmVyLCB0dWl0aW9uX2ZlZSwgYW1vdW50X2RheXMsIGFtb3VudF9yZWltYnVyc2UsIGluY2x1ZGVfc2lnbmF0dXJlPXRydWUsIGlzX2dvbGRzbWl0aHM9dHJ1ZSkge1xuICAgIFxuICAgIGxldCB1bmk7XG4gICAgaWYgKGlzX2dvbGRzbWl0aHMpIHtcbiAgICAgIHVuaSA9ICdHb2xkc21pdGhzIFVuaXZlcnNpdHkgb2YgTG9uZG9uJztcbiAgICB9IGVsc2Uge1xuICAgICAgdW5pID0gJ3lvdXIgdW5pdmVyc2l0eSc7XG4gICAgfVxuICAgIFxuICAgIGxldCBsYXRleCA9ICdcXFxcZG9jdW1lbnRjbGFzc3tsZXR0ZXJ9XFxuXFxcXHVzZXBhY2thZ2V7aHlwZXJyZWZ9XFxuXFxcXHVzZXBhY2thZ2V7Z3JhcGhpY3h9XFxuXFxcXHVzZXBhY2thZ2V7bWF0aHRvb2xzfVxcbidcblxuICAgIGxhdGV4ICs9XG5gXG5cXFxcRGVjbGFyZVBhaXJlZERlbGltaXRlclxcXFxmbG9vcntcXFxcbGZsb29yfXtcXFxccmZsb29yfVxuXG5cXFxcc2lnbmF0dXJleyR7Zmlyc3RfbmFtZX0gJHtsYXN0X25hbWV9fVxuXG5gO1xuXG4gICAgaWYgKGlzX2dvbGRzbWl0aHMpIHtcbiAgICAgIGxhdGV4ICs9IGBcXFxcYWRkcmVzc3tXYXJkZW7igJlzIE9mZmljZSBcXFxcXFxcXCBNcyBIZWxlbiBLZW9naCBcXFxcXFxcXCBNciBQYXRyaWNrIExvdWdocmV5IFxcXFxcXFxcIFxuRGVwdGZvcmQgVG93biBIYWxsIEJ1aWxkaW5nIFxcXFxcXFxcIFJvb20gMTAxIFxcXFxcXFxcIE5ldyBDcm9zcyBcXFxcXFxcXCBMb25kb24sIFVLIFxcXFxcXFxcIFxuU0UxNCA2TlcgXFxcXFxcXFwgMDIwIDc5MTkgNzkwMX1cblxuYDtcbiAgICB9XG4gICAgXG5sYXRleCArPSBgXFxcXGxvbmdpbmRlbnRhdGlvbj0wcHRcblxcXFxiZWdpbntkb2N1bWVudH1cblxuXFxcXGJlZ2lue2xldHRlcn17U3R1ZGVudCBOdW1iZXI6ICR7c3R1ZGVudF9udW1iZXJ9IFxcXFxcXFxcIEVtYWlsOiAke3N0dWRlbnRfZW1haWx9fVxuXFxcXG9wZW5pbmd7VG8gdGhlIFdhcmRlbidzIE9mZmljZX1cblxuVGhpcyBsZXR0ZXIgaXMgdG8gcmVxdWVzdCByZWFzb25hYmxlIGNvbXBlbnNhdGlvbiBmb3IgdGhlIGxvc3Mgb2YgbGVjdHVyZXMgYW5kIGNvbnRhY3QgdGltZSB3aXRoIHR1dG9ycyBhcyBhIHJlc3VsdCBvZiB0aGUgVUNVIHN0cmlrZSBhY3Rpb24gZnJvbSBGZWJydWFyeSAyMm5kIHRvIE1hcmNoIDE2dGguXG5cbkksIGFzIGEgc3R1ZGVudCBvZiAke3VuaX0sIGRlbWFuZCB0aGF0IHRoZSBpbnN0aXR1dGlvbiByZWZ1bmQgYSBwb3J0aW9uIG9mIG15IHR1aXRpb24sIHJlc3BlY3RpdmUgdG8gbXkgZW5yb2xsbWVudCBzdGF0dXMgYW5kIHByb2dyYW1tZS5cblxuRHVlIHRvIHRoZSBlbXBsb3llcuKAmXMgZmFpbHVyZSB0byBwcm90ZWN0IHRoZSBsaXZlbGlob29kcyBvZiBpdHMgc3RhZmYsIHRoZSBVQ1UgaGFzIG9yZ2FuaXplZCBhIGZvdXJ0ZWVuIGRheSBzdHJpa2UsIGFzIGEgbWVhbnMgb2Ygb3Bwb3NpbmcgdGhlIHJlY2VudCBwcm9wb3NhbHMgdGhhdCB3b3VsZCBkYW1hZ2UgdGhlIFVTUyBwZW5zaW9uIHNjaGVtZS4gQ29uc2VxdWVudGx5LCB0aGUgc3R1ZGVudCBib2R5IHN1ZmZlcnMgYSBsb3NzIG9mIGNyaXRpY2FsIG1lbnRvcnNoaXAgYW5kIGZhY2UgdGltZSB3aXRoIHRoZSBmYWN1bHR5LCBtb3N0IG5vdGFibHkgaW4gdGhlIGxvc3Mgb2Ygb3JnYW5pemVkIGNsYXNzIHRpbWUgc3VjaCBhcyBsZWN0dXJlcywgdHV0b3JpYWxzLCB3b3Jrc2hvcHMsIGFuZCBjcml0aXF1ZXMuXG5cbkNvbnNpZGVyaW5nIHRoYXQgZm9yIHRoZSBkdXJhdGlvbiBvZiB0aGUgc3RyaWtlIHN0dWRlbnRzIHdpbGwgbm90IGJlIGFjY2Vzc2luZyB0dWl0aW9uIG9yIGNyb3NzaW5nIHRoZSBwaWNrZXQgbGluZSB0byB1c2UgR29sZHNtaXRoc+KAmSBmYWNpbGl0aWVzLCBJIGJlbGlldmUgSSBzaG91bGQgYmUgcmVmdW5kZWQgdGhlIGZvbGxvd2luZyBhbW91bnQ6IFxcXFx0ZXh0YmZ7XFxcXHRleHRzdGVybGluZyAke2Ftb3VudF9yZWltYnVyc2V9fVxuXG5UaGlzIGFtb3VudCB3YXMgZGVyaXZlZCBmcm9tIHRoZSBmcmFjdGlvbiBvZiB0aGUgZGF5cyBtaXNzZWQgZHVlIHRvIHRoZSBzdHJpa2VzLCAkeCQsIG91dCBvZiB0aGUgYW1vdW50IG9mIGRheXMgaW4gdGhlIGFjYWRlbWljIHllYXIsICR5JCwgbXVsdGlwbGllZCBieSB0aGUgdHV0aW9uIGZlZXMgZm9yIHRoaXMgeWVhciAkeiQsIHdoaWNoIGlzIHRoZW4gZmxvb3JlZCAocm91bmRlZCBkb3duKSB0byB0aGUgbmVhcmVzdCBwb3VuZCBzdGVybGluZy5cblxuXFxcXGJlZ2lue2VxdWF0aW9ufVxuXFxcXGZsb29yKntcXFxcZnJhY3t4fXt5fXp9ID0gXFxcXHRleHR7XFxcXHRleHRzdGVybGluZ30gXFxcXGZsb29yKntcXFxcZnJhY3sxNH17JHthbW91bnRfZGF5c319IFxcXFx0aW1lcyAke3R1aXRpb25fZmVlfX0gPSBcXFxcdGV4dHtcXFxcdGV4dHN0ZXJsaW5nfSAke2Ftb3VudF9yZWltYnVyc2V9XG5cXFxcZW5ke2VxdWF0aW9ufVxuXG5JdCBpcyB0aGUgcmVzcG9uc2liaWxpdHkgb2YgdGhlIGluc3RpdHV0aW9uIHRvIHByb3ZpZGUgYSBjb21wbGV0ZSBhbmQgcXVhbGl0eSBlZHVjYXRpb24gdG8gZWFjaCBvZiBpdHMgc3R1ZGVudHMsIHRvIHRoZSBmdWxsZXN0IGV4dGVudCBhbmQgZHVyYXRpb24gdGhhdCBpdCB3YXMgYWR2ZXJ0aXNlZC4gQWRkaXRpb25hbGx5LCBJIGZpbmQgdGhlIGluc3RpdHV0aW9u4oCZcyBhZG1pbmlzdHJhdGlvbiB0byBiZSBkaXJlY3RseSBhY2NvdW50YWJsZSBmb3IgYm90aCB0aGUgaW5jZXB0aW9uIGFuZCB0aGUgZW50aXJlIGR1cmF0aW9uIG9mIHRoZSBzdHJpa2UuIEF0IGFueSBwb2ludCwgdGhlIHVuaXZlcnNpdHkgYWRtaW5pc3RyYXRpb24gY2FuIGNvbW1pdCB0byBtZWFuaW5nZnVsIG5lZ290aWF0aW9uIHRoYXQgd291bGQgZmFpcmx5IGFkZHJlc3MgdGhlIHN0YWZmIGNvbmNlcm5zIGFuZCBlbmQgdGhlIHN0cmlrZS4gQXMgYSByZXN1bHQgb2YgdGhlIHJpc2luZyBjb3N0IG9mIHVuaXZlcnNpdHkgdHVpdGlvbiwgc3R1ZGVudHMgYXJlIGJ1cmRlbmVkIGJ5IGluY3JlYXNpbmcgbGV2ZWxzIG9mIGRlYnQuIEl0IGlzIGlycmVzcG9uc2libGUgYW5kIHVubWVyaXRlZCBmb3IgdGhlIHVuaXZlcnNpdHkgdG8gZGVtYW5kIGVhY2ggb2YgaXRzIHN0dWRlbnRzIGluY3JlYXNlIHRoZWlyIHBlcnNvbmFsIGRlYnQgZm9yIGEgc2VydmljZSB0aGF0IGhhcyBiZWVuIGRlbmllZCB0byB0aGVtLlxuXG5cXFxcdnNwYWNlezNlbX1cblxuU2luY2VyZWx5LFxuXG5gO1xuXG5pZiAoaW5jbHVkZV9zaWduYXR1cmUpIHtcbiAgbGF0ZXggKz0gYFxuXFxcXGluY2x1ZGVncmFwaGljc1toZWlnaHQ9MTJlbV17JHtwc2lkfS5wbmd9YDtcbn1cbiAgICBcbiAgICBsYXRleCArPSBgXG5cbiR7Zmlyc3RfbmFtZX0gJHtsYXN0X25hbWV9XG5cblxcXFxlbmR7bGV0dGVyfVxuXFxcXGVuZHtkb2N1bWVudH1gOyAgXG4gICAgXG4gICAgcmV0dXJuIGxhdGV4O1xuICB9XG59OyJdfQ==",
    "ast": null,
    "map": {
      "version": 3,
      "sources": [
        "goldsmiths.js"
      ],
      "names": [
        "module",
        "exports",
        "generateLatexFile",
        "psid",
        "first_name",
        "last_name",
        "student_email",
        "student_number",
        "tuition_fee",
        "amount_days",
        "amount_reimburse",
        "include_signature",
        "is_goldsmiths",
        "uni",
        "latex"
      ],
      "mappings": ";;AAAAA,OAAOC,OAAP,GAAiB;;AAEfC,qBAAmB,2BAASC,IAAT,EAAeC,UAAf,EAA2BC,SAA3B,EAAsCC,aAAtC,EAAqDC,cAArD,EAAqEC,WAArE,EAAkFC,WAAlF,EAA+FC,gBAA/F,EAA6J;AAAA,QAA5CC,iBAA4C,uEAA1B,IAA0B;AAAA,QAApBC,aAAoB,uEAAN,IAAM;;;AAE9K,QAAIC,YAAJ;AACA,QAAID,aAAJ,EAAmB;AACjBC,YAAM,iCAAN;AACD,KAFD,MAEO;AACLA,YAAM,iBAAN;AACD;;AAED,QAAIC,QAAQ,oGAAZ;;AAEAA,uFAIUV,UAJV,SAIwBC,SAJxB;;AAQA,QAAIO,aAAJ,EAAmB;AACjBE;AAKD;;AAELA,8FAGkCP,cAHlC,qBAGgED,aAHhE,sPAQqBO,GARrB,8vBAYiOH,gBAZjO,wWAiBuED,WAjBvE,kBAiB+FD,WAjB/F,mCAiBwIE,gBAjBxI;;AA4BA,QAAIC,iBAAJ,EAAuB;AACrBG,qDAC+BX,IAD/B;AAED;;AAEGW,sBAEFV,UAFE,SAEYC,SAFZ;;AAOA,WAAOS,KAAP;AACD;AAtEc,CAAjB",
      "file": "goldsmiths.js",
      "sourceRoot": "/app",
      "sourcesContent": [
        "module.exports = {\n  \n  generateLatexFile: function(psid, first_name, last_name, student_email, student_number, tuition_fee, amount_days, amount_reimburse, include_signature=true, is_goldsmiths=true) {\n    \n    let uni;\n    if (is_goldsmiths) {\n      uni = 'Goldsmiths University of London';\n    } else {\n      uni = 'your university';\n    }\n    \n    let latex = '\\\\documentclass{letter}\\n\\\\usepackage{hyperref}\\n\\\\usepackage{graphicx}\\n\\\\usepackage{mathtools}\\n'\n\n    latex +=\n`\n\\\\DeclarePairedDelimiter\\\\floor{\\\\lfloor}{\\\\rfloor}\n\n\\\\signature{${first_name} ${last_name}}\n\n`;\n\n    if (is_goldsmiths) {\n      latex += `\\\\address{Warden’s Office \\\\\\\\ Ms Helen Keogh \\\\\\\\ Mr Patrick Loughrey \\\\\\\\ \nDeptford Town Hall Building \\\\\\\\ Room 101 \\\\\\\\ New Cross \\\\\\\\ London, UK \\\\\\\\ \nSE14 6NW \\\\\\\\ 020 7919 7901}\n\n`;\n    }\n    \nlatex += `\\\\longindentation=0pt\n\\\\begin{document}\n\n\\\\begin{letter}{Student Number: ${student_number} \\\\\\\\ Email: ${student_email}}\n\\\\opening{To the Warden's Office}\n\nThis letter is to request reasonable compensation for the loss of lectures and contact time with tutors as a result of the UCU strike action from February 22nd to March 16th.\n\nI, as a student of ${uni}, demand that the institution refund a portion of my tuition, respective to my enrollment status and programme.\n\nDue to the employer’s failure to protect the livelihoods of its staff, the UCU has organized a fourteen day strike, as a means of opposing the recent proposals that would damage the USS pension scheme. Consequently, the student body suffers a loss of critical mentorship and face time with the faculty, most notably in the loss of organized class time such as lectures, tutorials, workshops, and critiques.\n\nConsidering that for the duration of the strike students will not be accessing tuition or crossing the picket line to use Goldsmiths’ facilities, I believe I should be refunded the following amount: \\\\textbf{\\\\textsterling ${amount_reimburse}}\n\nThis amount was derived from the fraction of the days missed due to the strikes, $x$, out of the amount of days in the academic year, $y$, multiplied by the tution fees for this year $z$, which is then floored (rounded down) to the nearest pound sterling.\n\n\\\\begin{equation}\n\\\\floor*{\\\\frac{x}{y}z} = \\\\text{\\\\textsterling} \\\\floor*{\\\\frac{14}{${amount_days}} \\\\times ${tuition_fee}} = \\\\text{\\\\textsterling} ${amount_reimburse}\n\\\\end{equation}\n\nIt is the responsibility of the institution to provide a complete and quality education to each of its students, to the fullest extent and duration that it was advertised. Additionally, I find the institution’s administration to be directly accountable for both the inception and the entire duration of the strike. At any point, the university administration can commit to meaningful negotiation that would fairly address the staff concerns and end the strike. As a result of the rising cost of university tuition, students are burdened by increasing levels of debt. It is irresponsible and unmerited for the university to demand each of its students increase their personal debt for a service that has been denied to them.\n\n\\\\vspace{3em}\n\nSincerely,\n\n`;\n\nif (include_signature) {\n  latex += `\n\\\\includegraphics[height=12em]{${psid}.png}`;\n}\n    \n    latex += `\n\n${first_name} ${last_name}\n\n\\\\end{letter}\n\\\\end{document}`;  \n    \n    return latex;\n  }\n};"
      ]
    },
    "mtime": 1521481584337
  }
}